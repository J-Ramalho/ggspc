<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Design of Experiments | industRial data science</title>
  <meta name="description" content="Design of Experiments | industRial data science" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Design of Experiments | industRial data science" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/cover3.png" />
  
  <meta name="github-repo" content="J-Ramalho/industRialds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Design of Experiments | industRial data science" />
  
  
  <meta name="twitter:image" content="img/cover3.png" />

<meta name="author" content="JoÃ£o Ramalho" />


<meta name="date" content="2021-06-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="MSA.html"/>
<link rel="next" href="SPC.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122820355-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-122820355-1');
</script>


<script type="text/javascript">
mattcrump=1;
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/industRialds.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">industRial</a></li>

<li class="divider"></li>
<li class="part"><span><b>I INTRODUCTION</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html"><i class="fa fa-check"></i>Toolbox</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#r-and-rstudio"><i class="fa fa-check"></i>R and RStudio</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#packages"><i class="fa fa-check"></i>Packages</a>
<ul>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#highlights"><i class="fa fa-check"></i>Highlights</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#datasets"><i class="fa fa-check"></i>Datasets</a></li>
<li class="chapter" data-level="" data-path="toolbox.html"><a href="toolbox.html#functions"><i class="fa fa-check"></i>Functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html"><i class="fa fa-check"></i>Tutorials</a>
<ul>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html#on-the-web"><i class="fa fa-check"></i>On the web</a></li>
<li class="chapter" data-level="" data-path="tutorials.html"><a href="tutorials.html#locally"><i class="fa fa-check"></i>Locally</a></li>
</ul></li>
<li class="part"><span><b>II CASE STUDIES</b></span></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html"><i class="fa fa-check"></i>Design for Six Sigma</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#pareto-analysis"><i class="fa fa-check"></i>Pareto analysis</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#collecting-defects"><i class="fa fa-check"></i>Collecting defects</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#paretochart"><i class="fa fa-check"></i>Pareto chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#root-cause-analysis"><i class="fa fa-check"></i>Root cause analysis</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#brainstorming"><i class="fa fa-check"></i>Brainstorming</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#ishikawa"><i class="fa fa-check"></i>Ishikawa digram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#correlations"><i class="fa fa-check"></i>Correlations</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#matrix"><i class="fa fa-check"></i>Matrix</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#tileplot"><i class="fa fa-check"></i>Tileplot</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#clustering"><i class="fa fa-check"></i>Clustering</a>
<ul>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#clustering-algorithms"><i class="fa fa-check"></i>Clustering algorithms</a></li>
<li class="chapter" data-level="" data-path="design-for-six-sigma.html"><a href="design-for-six-sigma.html#network_plot"><i class="fa fa-check"></i>Network plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html"><i class="fa fa-check"></i>Measurement System Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#calibration"><i class="fa fa-check"></i>Calibration</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#bias_plot"><i class="fa fa-check"></i>Bias plot</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#bias_report"><i class="fa fa-check"></i>Bias report</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#precision"><i class="fa fa-check"></i>Precision</a>
<ul>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gageRnR"><i class="fa fa-check"></i>Gage r&amp;R</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gage_acceptance"><i class="fa fa-check"></i>Gage acceptance</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#gage-plots"><i class="fa fa-check"></i>Gage plots</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#negative-variance"><i class="fa fa-check"></i>Negative variance</a></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#custom-functions"><i class="fa fa-check"></i>Custom functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="MSA.html"><a href="MSA.html#uncertainty"><i class="fa fa-check"></i>Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html"><i class="fa fa-check"></i>Design of Experiments</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#direct-comparisons"><i class="fa fa-check"></i>Direct comparisons</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#histogram"><i class="fa fa-check"></i>Histogram</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#t.test"><i class="fa fa-check"></i>t-test one sample</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#geom_qq"><i class="fa fa-check"></i>Normality plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#var.test"><i class="fa fa-check"></i>F-test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#levene.test"><i class="fa fa-check"></i>Levene test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#t-test-two-samples"><i class="fa fa-check"></i>t-test two samples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#statistical-modeling"><i class="fa fa-check"></i>Statistical modeling</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#lm"><i class="fa fa-check"></i>Linear models</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#contr.treatment"><i class="fa fa-check"></i>Contrasts</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#predict"><i class="fa fa-check"></i>Predict</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#augment"><i class="fa fa-check"></i>Model augment</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#residuals_timeseries"><i class="fa fa-check"></i>Timeseries plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#autocorrelation"><i class="fa fa-check"></i>Autocorrelation test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#normality-plot"><i class="fa fa-check"></i>Normality plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#shapiroTest"><i class="fa fa-check"></i>Normality test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#residuals_fit"><i class="fa fa-check"></i>Residuals-Fit plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#std_residuals_fit"><i class="fa fa-check"></i>Standard Residuals-Fit plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#std_residuals_factors"><i class="fa fa-check"></i>Standard Residuals-Factor plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#homocedasticity"><i class="fa fa-check"></i>Homocedasticity</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#outliers"><i class="fa fa-check"></i>Outliers test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cooks"><i class="fa fa-check"></i>Cooks distance</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#R-squared"><i class="fa fa-check"></i>R-squared</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#effects-significance"><i class="fa fa-check"></i>Effects significance</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#aov"><i class="fa fa-check"></i>Anova</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#tukey"><i class="fa fa-check"></i>Pairwise comparison</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#fisherLSD"><i class="fa fa-check"></i>Least significant difference</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interactions"><i class="fa fa-check"></i>Interactions</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#formula"><i class="fa fa-check"></i>Model formulae</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#RSE"><i class="fa fa-check"></i>Residuals standard error</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#plot.lm"><i class="fa fa-check"></i>Residuals summary</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interaction.plot"><i class="fa fa-check"></i>Interaction plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova"><i class="fa fa-check"></i>Anova with interactions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#covariance"><i class="fa fa-check"></i>Covariance</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#cor.test"><i class="fa fa-check"></i>Correlation test</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#ancova_aov"><i class="fa fa-check"></i>Ancova</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#general-designs"><i class="fa fa-check"></i>General designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#fac.design"><i class="fa fa-check"></i>Factorial design</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#main_effects"><i class="fa fa-check"></i>Main effects plots</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#interaction_plot"><i class="fa fa-check"></i>Interaction plots (custom)</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#formula_expansion"><i class="fa fa-check"></i>Formula expansion</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#anova_three"><i class="fa fa-check"></i>Anova with 3rd level interactions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#two-level-designs"><i class="fa fa-check"></i>Two level designs</a>
<ul>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#factorial-design-2-levels"><i class="fa fa-check"></i>Factorial design 2 levels</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coding_levels"><i class="fa fa-check"></i>Coding levels</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#plotMeans"><i class="fa fa-check"></i>Interaction plots with SE</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#adj_Rsquare"><i class="fa fa-check"></i>Adjusted R-squared</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coding_inputs"><i class="fa fa-check"></i>Coding inputs</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#coded_prediction"><i class="fa fa-check"></i>Coded prediction</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#persp"><i class="fa fa-check"></i>Perspective plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#single_replicate"><i class="fa fa-check"></i>Single replicate</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#qqPlot"><i class="fa fa-check"></i>Effects normal plot</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#effects_contribution"><i class="fa fa-check"></i>Effects contribution table</a></li>
<li class="chapter" data-level="" data-path="DOE.html"><a href="DOE.html#reduced-model"><i class="fa fa-check"></i>Reduced model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html"><i class="fa fa-check"></i>Statistical Process Control</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#xbar-r-charts"><i class="fa fa-check"></i>xbar-R charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#xbar_chart"><i class="fa fa-check"></i>Mean chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#Rchart"><i class="fa fa-check"></i>Range chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#limits.xbar"><i class="fa fa-check"></i>Warning limits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#cpk-charts"><i class="fa fa-check"></i>Cpk charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#off_spec"><i class="fa fa-check"></i>Off spec</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process_Cpk"><i class="fa fa-check"></i>Process Capability</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#sigma_table"><i class="fa fa-check"></i>Sigma conversion table</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process.capability"><i class="fa fa-check"></i>Capability chart</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#i-mr-charts"><i class="fa fa-check"></i>I-MR charts</a>
<ul>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#process_stats"><i class="fa fa-check"></i>Process statistics</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_I"><i class="fa fa-check"></i>Individual chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_IMR"><i class="fa fa-check"></i>Moving range chart</a></li>
<li class="chapter" data-level="" data-path="SPC.html"><a href="SPC.html#chart_Cpk"><i class="fa fa-check"></i>Capability chart (custom)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III APPENDIX</b></span></li>
<li class="chapter" data-level="" data-path="contents.html"><a href="contents.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#statistics"><i class="fa fa-check"></i>Statistics</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#notation-conventions"><i class="fa fa-check"></i>Notation conventions</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive statistics</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#probability"><i class="fa fa-check"></i>Probability</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#statistical-inference"><i class="fa fa-check"></i>Statistical Inference</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#linear-models"><i class="fa fa-check"></i>Linear models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#dfss"><i class="fa fa-check"></i>DFSS</a>
<ul>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#voice-of-customer"><i class="fa fa-check"></i>Voice of Customer</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#voice-of-process"><i class="fa fa-check"></i>Voice of Process</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#msa"><i class="fa fa-check"></i>MSA</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#doe"><i class="fa fa-check"></i>DOE</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html#spc"><i class="fa fa-check"></i>SPC</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="imprint.html"><a href="imprint.html"><i class="fa fa-check"></i>Imprint</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">indust<b style='color:#38598CFF'>R</b>ial data science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="DOE" class="section level1">
<h1>Design of Experiments</h1>
<p>Companies manufacturing goods in industrial quantities have a permanent need to improve the features of their products. This is visible in any such industry be it car parts, watches, electronic components for cell phones, chocolates, clothing, medical devices, medicine, â¦ the list could go on forever. As consumers we expect flawless quality at affordable price and we want to remain free to choose another brand if our confidence has been damaged due to a defective product. Adding to this fortunately the last decades have seen an increasing pressure to develop sustainable products that are responsibly sourced, meet stringent regulations and can last for many years and be properly disposable. Another constraint that can be observed in Research and Development is the growing awareness of the public on ethical issues. There is an increasing expectation that trials generate minimal waste and are done in a way respectful of test subjects human and animal.</p>
<p>Experiment design provides ways to meet these important requirements by making us think upfront on what is required and how to best approach a test. Integrated in a complete solid design for quality approach it can provide deep insights on the principles of a system and support decision making based on data. A well prepared test plan minimizes trial and error and reduces the number of prototypes, measurements and time required.</p>
<p>There are many well tested approaches, the domain is very large and our textbook can only cover a subset of the many types of DoEs used in the industry. For all these cases statistical notions are key to have a minimal preparation of the test and a valid interpretation of the results. Some statistical concepts every engineer, technician or scientist has to understand go around sampling, sample size, probability, correlation and variability. It is important to be clear about the vocabulary and the mathematics that are behind the constantly used statistics such as the mean, median, variance, standard deviation and so on. We provide a glossary and good bibliography that can be both a good starting point or a refresher. In particular the text and the case studies follow what we consider to be the most important book in this the domain, the <em>Design and Analysis of Experiments</em> by <span class="citation"><a href="references.html#ref-Montgomery2012" role="doc-biblioref">Montgomery</a> (<a href="references.html#ref-Montgomery2012" role="doc-biblioref">2012</a>)</span>.</p>
<div id="direct-comparisons" class="section level2">
<h2>Direct comparisons</h2>
<div class="marginnote">
<p><b class="highlight">Case study: winter sports clothing</b></p>
<p>All winter sports clothing are virtually made with a mix of natural fibers and synthetic polymers. Upgrading to recyclable polymers while keeping performance requires extensive testing of raw material characteristics such as the tensile strength.</p>
<p><img src="img/tensile_test_bw.jpg" width="100%" /></p>
</div>
<p>We start by exploring simple tests that compare results obtained in two samples. These cases happen all the time as everyone needs one moment or another to compare things. It can be the result of a test before and after an improvement, it can be two different materials applied in the same assembly or still different results obtained by different teams at different moments.</p>
<p>In this case, a materials engineer working in the <b class="highlight">winter sports clothing industry</b> is working with a polymer company to develop a textile raw material based on PET for which the mean tensile strength has to be greater than 69.0 MPa. A first delivery of samples arrives, the materials laboratory measures 28 samples and reports that the test result is not meeting the contract specification. The materials engineer is informed and get hold of the raw data, in the lab system she can see the measurement summary:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="DOE.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_delivery<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   64.5    68.2    68.8    68.7    69.4    72.0 </code></pre>
<p>The mean is in fact slightly lower that the specified contract value of 69 and the materials engineer could think to confirm the rejection the batch right away. She decides nevertheless to observe how do the measurements vary. She plots the raw data on an histogram which is a very common plot showing counts for selected intervals.</p>
<div id="histogram" class="section level3">
<h3>Histogram</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="DOE.html#cb77-1" aria-hidden="true" tabindex="-1"></a>pet_spec <span class="ot">&lt;-</span> <span class="dv">69</span></span>
<span id="cb77-2"><a href="DOE.html#cb77-2" aria-hidden="true" tabindex="-1"></a>pet_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pet_delivery<span class="sc">$</span>A)</span>
<span id="cb77-3"><a href="DOE.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="DOE.html#cb77-4" aria-hidden="true" tabindex="-1"></a>pet_delivery <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="DOE.html#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> A)) <span class="sc">+</span></span>
<span id="cb77-6"><a href="DOE.html#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>], <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-7"><a href="DOE.html#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb77-8"><a href="DOE.html#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pet_mean, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="DOE.html#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pet_spec, <span class="at">color =</span> <span class="st">&quot;darkred&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>, </span>
<span id="cb77-10"><a href="DOE.html#cb77-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb77-11"><a href="DOE.html#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET raw material delivery&quot;</span>,</span>
<span id="cb77-12"><a href="DOE.html#cb77-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Histogram of resistance measurements&quot;</span>,</span>
<span id="cb77-13"><a href="DOE.html#cb77-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb77-14"><a href="DOE.html#cb77-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>, </span>
<span id="cb77-15"><a href="DOE.html#cb77-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Specification min in red, Batch mean in blueÂ¨&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fig-pethistogram-1.png" width="100%" /></p>
<p>She also observes a certain variability in the batch with many samples with measurements below specification getting close to 64 MPa. She remembers that in this case a t-test could help assessing if the mean that was obtained can be really be considered statistically different from the target value.</p>
</div>
<div id="t.test" class="section level3">
<h3>t-test one sample</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="DOE.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="at">x =</span> pet_delivery<span class="sc">$</span>A, <span class="at">mu =</span> pet_spec)</span></code></pre></div>
<pre><code>
	One Sample t-test

data:  pet_delivery$A
t = -1.08, df = 27, p-value = 0.29
alternative hypothesis: true mean is not equal to 69
95 percent confidence interval:
 68.157 69.263
sample estimates:
mean of x 
    68.71 </code></pre>
<p>The basic assumption of the test is that the mean and the reference value are identical and the alternative hypothesis is that their different. The confidence interval selected is 95% as it is common practice in the laboratory. The test result tells us that for a population average of 69, the probability of obtaining a sample with a value as extreme as 68.71 is 29% (p = 0.29). This probability value higher than the limit of 5% that she usually uses to reject the null hypothesis. In fact she cannot conclude that the sample comes from a population with a mean different than 69.</p>
<p>Sheâs not sure what to do of this result and decides asking help to a colleague statistician from R&amp;D: has she applied the right? is the specification correctly defined or should it refer to the minimum sample value? Her colleague confirms that to compare means this is a good approach and as the standard deviation of the production is not available it is reasonable to use the standard deviation from the sample. This is an important detail that was not introduced explicitely as an argument in the R function. As we they are still in the initial steps of the new development they agree that it is a good idea to accept the batch. For the next deliveries the statistic recommends to try to improve the tensile strength average and reduce the variability. For the next delivery she also recommends to agree on a minimum sample size of 30 parts and to redo the t.test but for regular production the team should consider implementing a proper AQL protocol.</p>
<p>Improving recyclability while keeping current performance is no easy task. Often novel materials are expensive as their commercial volumes are small and suppliers claim a premium on their own R&amp;D efforts. Consumers of clothing are getting more and more sensitive to waste and to recycling but they donât always choose products with a higher price to compensate.</p>
<p>Following the not fully successful experience with the first delivery of recyclable PET our materials engineer considers a new chemical composition that potentially increases the levels of strength. When the second delivery arrives she establishes a simple plot with the raw data to have a first grasp of the expected improvement.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="DOE.html#cb80-1" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="ot">&lt;-</span> pet_delivery <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="DOE.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb80-3"><a href="DOE.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tensile_strength&quot;</span></span>
<span id="cb80-4"><a href="DOE.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-5"><a href="DOE.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="DOE.html#cb80-6" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="DOE.html#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> tensile_strength)) <span class="sc">+</span></span>
<span id="cb80-8"><a href="DOE.html#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb80-9"><a href="DOE.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-10"><a href="DOE.html#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET clothing case study&quot;</span>,</span>
<span id="cb80-11"><a href="DOE.html#cb80-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb80-12"><a href="DOE.html#cb80-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Sample&quot;</span>,</span>
<span id="cb80-13"><a href="DOE.html#cb80-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fig-PETjitterplot-1.png" width="100%" /></p>
<p>Choosing <code>geom_jitter()</code> instead of simply <code>geom_point()</code> avoids overlapping of the dots but has to used with caution as sometimes for precise reading can lead to mistakes. Dot plots also lack information sample statistics and a way to better understanding the bond distributions is to go for a box plot. This type of plot is somehow like the histogram seen before but more compact when several groups are required to be plotted.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="DOE.html#cb81-1" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="DOE.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> tensile_strength, <span class="at">fill =</span> sample)) <span class="sc">+</span></span>
<span id="cb81-3"><a href="DOE.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-4"><a href="DOE.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb81-5"><a href="DOE.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">begin =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="DOE.html#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="DOE.html#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb81-8"><a href="DOE.html#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET clothing case study&quot;</span>,</span>
<span id="cb81-9"><a href="DOE.html#cb81-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Box plot&quot;</span>,</span>
<span id="cb81-10"><a href="DOE.html#cb81-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Sample&quot;</span>,</span>
<span id="cb81-11"><a href="DOE.html#cb81-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fig-PETboxplot-1.png" width="100%" /></p>
<p>In this case she has simply added another layer to the previous plot getting both the dots and the boxes. Now she can see the median and the quantiles. The new sample has clearly higher values and she would like to confirm if the new formulation has a significant effect. While before she was comparing the sample mean with the specification, here she wants to compare the means of the two samples. A direct calculation of this difference gives:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="DOE.html#cb82-1" aria-hidden="true" tabindex="-1"></a>PET_meandiff <span class="ot">&lt;-</span> <span class="fu">mean</span>(pet_delivery<span class="sc">$</span>A) <span class="sc">-</span> <span class="fu">mean</span>(pet_delivery<span class="sc">$</span>B)</span>
<span id="cb82-2"><a href="DOE.html#cb82-2" aria-hidden="true" tabindex="-1"></a>PET_meandiff</span></code></pre></div>
<pre><code>[1] -0.86286</code></pre>
<p>To use the t.test it is important to have samples obtained independently and randomly, to check the normality of their distributions and the equality of their variances.</p>
<p>To do these checks our materials engineer is using the <code>geom_qq()</code> function from the <code>{ggplot}</code> package and gets directly the normality plots for both samples in the same plot:</p>
</div>
<div id="geom_qq" class="section level3">
<h3>Normality plot</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="DOE.html#cb84-1" aria-hidden="true" tabindex="-1"></a>pet_delivery_long <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="DOE.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> tensile_strength, <span class="at">color =</span> sample)) <span class="sc">+</span></span>
<span id="cb84-3"><a href="DOE.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb84-4"><a href="DOE.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb84-5"><a href="DOE.html#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb84-6"><a href="DOE.html#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="DOE.html#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PET clothing case study&quot;</span>,</span>
<span id="cb84-8"><a href="DOE.html#cb84-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Q-Q plot&quot;</span>,</span>
<span id="cb84-9"><a href="DOE.html#cb84-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb84-10"><a href="DOE.html#cb84-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Tensile strength [MPa]&quot;</span>)</span></code></pre></div>
<p><img src="5_comparisons_files/figure-html/fit-PETqqplot-1.png" width="100%" /></p>
<p>We observe that for both formulation the data is adhering to the straight line thus we consider that it follows a normal distribution. We also see that both lines in the qq plot have equivalent slopes indicating that the assumption of variances is a reasonable one. Visual observations are often better supported by tests such as the variance test.</p>
</div>
<div id="var.test" class="section level3">
<h3>F-test</h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="DOE.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(tensile_strength <span class="sc">~</span> sample, pet_delivery_long)</span></code></pre></div>
<pre><code>
	F test to compare two variances

data:  tensile_strength by sample
F = 1.28, num df = 27, denom df = 27, p-value = 0.53
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.59026 2.75635
sample estimates:
ratio of variances 
            1.2755 </code></pre>
<p>The <code>var.test()</code> from the <code>{stats}</code> package us a simple and direct way to compare variances. The F-test is accurate only for normally distributed data. Any small deviation from normality can cause the F-test to be inaccurate, even with large samples. However, if the data conform well to the normal distribution, then the F-test is usually more powerful than Leveneâs test. The test null hypothesis is that the variances are equal. Since the p value is much greater than 0.05 we cannot reject the null hypotheses meaning that we can consider them equal.</p>
</div>
<div id="levene.test" class="section level3">
<h3>Levene test</h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="DOE.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb87-2"><a href="DOE.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(tensile_strength <span class="sc">~</span> sample, <span class="at">data =</span> pet_delivery_long)</span></code></pre></div>
<pre><code>Levene&#39;s Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  1    0.01   0.91
      54               </code></pre>
<p>We had considered the samples to be normaly distributed but we can be more conservative and use the <code>leveneTest()</code> function from the <code>{car}</code> package. In this case we get a p &gt; 0.05 thus again we see that there is homogeneity of the variances (they do not differ significantly). Further elaborations on the variance can be found under <span class="citation"><a href="references.html#ref-minitab_variances" role="doc-biblioref">Minitab</a> (<a href="references.html#ref-minitab_variances" role="doc-biblioref">2019a</a>)</span>.</p>
<p>The clothing sports materials engineer has now a view on the samples distribution and homogeity of variances and can apply t.test to compare the sample means. She takes care to specify the <code>var.equal</code> argument as TRUE (by default it is FALSE).</p>
</div>
<div id="t-test-two-samples" class="section level3">
<h3>t-test two samples</h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="DOE.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(</span>
<span id="cb89-2"><a href="DOE.html#cb89-2" aria-hidden="true" tabindex="-1"></a>  tensile_strength <span class="sc">~</span> sample, </span>
<span id="cb89-3"><a href="DOE.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_delivery_long, <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb89-4"><a href="DOE.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>
	Two Sample t-test

data:  tensile_strength by sample
t = -2.4, df = 54, p-value = 0.02
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -1.58500 -0.14072
sample estimates:
mean in group A mean in group B 
         68.710          69.573 </code></pre>
<p>She sees that p &lt; 0.05 and confirms the means differ significantly. The test output has also provided a confidence interval for the difference between the means at 95% probability and the mean difference calculated directly of -0.86286 falls inside this interval (to be noted that zero is obviously not included in this interval). Things look promising in the new recyclable PET formulation.</p>

</div>
</div>
<div id="statistical-modeling" class="section level2">
<h2>Statistical modeling</h2>
<div class="marginnote">
<p><b class="highlight">Case study: e-bike frame hardening</b></p>
<p>Demand for electrical bicycles grows steadily and a global manufacturer is looking into improving the quality of his bicycle frames. A test program around different treatment temperatures is established to find the conditions that optimize the fatigue resistance.</p>
<p><img src="img/bike_frames_bw.jpg" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p>A way to go beyond the statistical description of samples and direct comparison between different tests it is to establish a model. Models help us simplify the reality and draw general conclusions. The case studies in this unit introduce linear models and their applications. They also serve as the backbone for statistical inference and forecasting. These are two important techniques because they provide mathematical evidence of such general conclusions in a context where the test quantities are strongly limited as for example in lifecycle testing of expensive mechanical parts.</p>
<p>Bicycle frames are submitted to many different efforts, namely bending, compression and vibration. Obviously no one expects a bike frame to break in regular usage and it is hard to commercialy claim resistance to failure as a big thing. Nevertheless on the long term a manufacturer reputation is made on performance features such as the number of cycles of effort that the frame resists. An e-bike manufacturing company is looking to increase the duration of its frames by improving the <b class="highlight">e-bike frame hardening</b> process.</p>
<p>A test has been run with 5 groups of 30 bike frames submitted to 4 different treatment temperature levels and the data collected in the R tibble <code>ebike_hardening</code> presented below:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="DOE.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_hardening) <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="DOE.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">temperature</th>
<th align="center">g1</th>
<th align="center">g2</th>
<th align="center">g3</th>
<th align="center">g4</th>
<th align="center">g5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">160</td>
<td align="center">575000</td>
<td align="center">542000</td>
<td align="center">530000</td>
<td align="center">539000</td>
<td align="center">570000</td>
</tr>
<tr class="even">
<td align="center">180</td>
<td align="center">565000</td>
<td align="center">593000</td>
<td align="center">590000</td>
<td align="center">579000</td>
<td align="center">610000</td>
</tr>
<tr class="odd">
<td align="center">200</td>
<td align="center">600000</td>
<td align="center">651000</td>
<td align="center">610000</td>
<td align="center">637000</td>
<td align="center">629000</td>
</tr>
<tr class="even">
<td align="center">220</td>
<td align="center">725000</td>
<td align="center">700000</td>
<td align="center">715000</td>
<td align="center">685000</td>
<td align="center">710000</td>
</tr>
</tbody>
</table>
<p>This type of two way entry is friendly for data collection but for manipulation with the <code>{tidyverse}</code> package functions it is often better to transform it in a long format.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="DOE.html#cb92-1" aria-hidden="true" tabindex="-1"></a>ebike_narrow <span class="ot">&lt;-</span> ebike_hardening <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="DOE.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb92-3"><a href="DOE.html#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;g&quot;</span>),</span>
<span id="cb92-4"><a href="DOE.html#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;observation&quot;</span>,</span>
<span id="cb92-5"><a href="DOE.html#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;cycles&quot;</span></span>
<span id="cb92-6"><a href="DOE.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb92-7"><a href="DOE.html#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature) <span class="sc">%&gt;%</span></span>
<span id="cb92-8"><a href="DOE.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cycles_mean =</span> <span class="fu">mean</span>(cycles)) <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="DOE.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb92-10"><a href="DOE.html#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="DOE.html#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_head</span>(<span class="at">.data =</span> ebike_narrow, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-12"><a href="DOE.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb92-13"><a href="DOE.html#cb92-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;e-bike hardening experiment data&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:fig-ebikenarrow">Table 5: </span>e-bike hardening experiment data</caption>
<thead>
<tr class="header">
<th align="center">temperature</th>
<th align="center">observation</th>
<th align="center">cycles</th>
<th align="center">cycles_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">160</td>
<td align="center">g1</td>
<td align="center">575000</td>
<td align="center">551200</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">g2</td>
<td align="center">542000</td>
<td align="center">551200</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">g3</td>
<td align="center">530000</td>
<td align="center">551200</td>
</tr>
<tr class="even">
<td align="center">160</td>
<td align="center">g4</td>
<td align="center">539000</td>
<td align="center">551200</td>
</tr>
<tr class="odd">
<td align="center">160</td>
<td align="center">g5</td>
<td align="center">570000</td>
<td align="center">551200</td>
</tr>
</tbody>
</table>
<p>The engineering team is looking forward to see the first results which have been prepared by the laboratory supervisor. He has prepared a series of plots and data models and sent out an draft report. The first plot is a simple dot plot having the raw data and in red the group means.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="DOE.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ebike_narrow) <span class="sc">+</span></span>
<span id="cb93-2"><a href="DOE.html#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles)) <span class="sc">+</span></span>
<span id="cb93-3"><a href="DOE.html#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="DOE.html#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb93-5"><a href="DOE.html#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-6"><a href="DOE.html#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb93-7"><a href="DOE.html#cb93-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb93-8"><a href="DOE.html#cb93-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [Â°C]&quot;</span>,</span>
<span id="cb93-9"><a href="DOE.html#cb93-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-rawdataplot-1.png" width="100%" /></p>
<p>Clearly the highest the furnace temperature the higher the number of cycles to failure. This is absolutely expected as higher temperatures, up to a certain level, allow to release mechanical tensions and make the material less prone to fracture. The team knows that other factors are at play such as the treatment duration, the pre-heating temperature and many others related with the welding of the frame parts, but has deliberately decided to look only into the temperature due to time constraints related with a new bike launch.</p>
<p>It is good to complement the raw data plot with a regression line corresponding to this linear model as done in the next chunk with the function <code>geom_smooth()</code>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="DOE.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ebike_narrow) <span class="sc">+</span></span>
<span id="cb94-2"><a href="DOE.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles)) <span class="sc">+</span></span>
<span id="cb94-3"><a href="DOE.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-4"><a href="DOE.html#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-5"><a href="DOE.html#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb94-6"><a href="DOE.html#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-7"><a href="DOE.html#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb94-8"><a href="DOE.html#cb94-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb94-9"><a href="DOE.html#cb94-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [Â°C]&quot;</span>,</span>
<span id="cb94-10"><a href="DOE.html#cb94-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikesmooth-1.png" width="100%" /></p>
<p>This visualization shows how a linear regression line adjusts to the data and we can see it is not passing exactly at the means of each treatment level. In the next steps we go into the functions underneath that are used to calculate the regression line.</p>
<div id="lm" class="section level3">
<h3>Linear models</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="DOE.html#cb95-1" aria-hidden="true" tabindex="-1"></a>ebike_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(cycles <span class="sc">~</span> temperature, <span class="at">data =</span> ebike_narrow)</span>
<span id="cb95-2"><a href="DOE.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_lm)</span></code></pre></div>
<pre><code>
Call:
lm(formula = cycles ~ temperature, data = ebike_narrow)

Residuals:
   Min     1Q Median     3Q    Max 
-43020 -12325  -1210  16710  33060 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   137620      41211    3.34   0.0036 ** 
temperature     2527        215   11.73  7.3e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 21500 on 18 degrees of freedom
Multiple R-squared:  0.884,	Adjusted R-squared:  0.878 
F-statistic:  138 on 1 and 18 DF,  p-value: 7.26e-10</code></pre>
<p>This previoous code chunk from the lab supervisor draft report is a linear model built with the variable <code>temperature</code> as a numeric vector. The R <code>summary()</code> function produces a specific output for linear models and a dedicated help explaining each output value can be accessed with <code>?summary.lm</code>. Knowing that R uses specific âmethodsâ to provide the summaries for many functions is useful to find their help pages and a way to list them is <code>apropos("summary)</code>. In this case we see a high R-squared suggesting a very good fit and that the temperature is significant by looking at the 3 <em>significance stars</em> next to its p-value.</p>
</div>
<div id="contr.treatment" class="section level3">
<h3>Contrasts</h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="DOE.html#cb97-1" aria-hidden="true" tabindex="-1"></a>ebike_factor <span class="ot">&lt;-</span> ebike_narrow <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="DOE.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temperature =</span> <span class="fu">as_factor</span>(temperature))</span>
<span id="cb97-3"><a href="DOE.html#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="DOE.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(ebike_factor<span class="sc">$</span>temperature) <span class="ot">&lt;-</span> contr.treatment</span>
<span id="cb97-5"><a href="DOE.html#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="DOE.html#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(ebike_factor<span class="sc">$</span>temperature)</span></code></pre></div>
<pre><code>$levels
[1] &quot;160&quot; &quot;180&quot; &quot;200&quot; &quot;220&quot;

$class
[1] &quot;factor&quot;

$contrasts
    2 3 4
160 0 0 0
180 1 0 0
200 0 1 0
220 0 0 1</code></pre>
<p>The engineering team has selected to specify and control the temperature variable at specific levels in what is called a fixed effects model, limiting the conclusions to the levels tested. The lab supervisor updates his dataset by converting the temperature variable to a factor and explicitly establishes the factor <code>contrasts</code> with the <code>contrasts()</code> function. He selects <code>cont.treatment</code>. Looking into the attributes of the factor we see the matrix of contrasts. In many cases it is possible to skip this step as contr.treament is default setting for the contrasts. This can be confirmed with <code>getOption("contrasts")</code>. He can now establish a new linear model using the modified dataset.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="DOE.html#cb99-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb99-2"><a href="DOE.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  cycles <span class="sc">~</span> temperature, </span>
<span id="cb99-3"><a href="DOE.html#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ebike_factor</span>
<span id="cb99-4"><a href="DOE.html#cb99-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb99-5"><a href="DOE.html#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_lm_factor)</span></code></pre></div>
<pre><code>
Call:
lm(formula = cycles ~ temperature, data = ebike_factor)

Residuals:
   Min     1Q Median     3Q    Max 
-25400 -13000   2800  13200  25600 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    551200       8170   67.47  &lt; 2e-16 ***
temperature2    36200      11553    3.13   0.0064 ** 
temperature3    74200      11553    6.42  8.4e-06 ***
temperature4   155800      11553   13.49  3.7e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 18300 on 16 degrees of freedom
Multiple R-squared:  0.926,	Adjusted R-squared:  0.912 
F-statistic: 66.8 on 3 and 16 DF,  p-value: 2.88e-09</code></pre>
<p>We see that from the first model to the second the R-squared has improved and that the model coefficients are slightly different. In R the model coefficients depend on the variable variable data type and on the contrasts setting. To obtain equivalent results with the different type coding it is necessary to carefully set the model <em>contrasts</em>. These differences are due to the calculation of different linear regression equations with different coefficients. It is important to be attemptive before using whatever output the system is giving us. We can see the coefficients and use them to calculate the output with a matrix multiplication as follows:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="DOE.html#cb101-1" aria-hidden="true" tabindex="-1"></a>ebike_lm<span class="sc">$</span>coefficients </span></code></pre></div>
<pre><code>(Intercept) temperature 
     137620        2527 </code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="DOE.html#cb103-1" aria-hidden="true" tabindex="-1"></a>ebike_lm<span class="sc">$</span>coefficients <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">180</span>)</span></code></pre></div>
<pre><code>       [,1]
[1,] 592480</code></pre>
<p>this shows that to calculate the output for an input of 180 we have 137â620 + 180 x 2â527 = 592â480. Making a zoom on the linear regression plot we see this passes slightly above the mean for the 180Â°C treatment level:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="DOE.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ebike_narrow) <span class="sc">+</span></span>
<span id="cb105-2"><a href="DOE.html#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles)) <span class="sc">+</span></span>
<span id="cb105-3"><a href="DOE.html#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb105-4"><a href="DOE.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb105-5"><a href="DOE.html#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">20</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb105-6"><a href="DOE.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">160</span>, <span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">520000</span>, <span class="dv">620000</span>)) <span class="sc">+</span></span>
<span id="cb105-7"><a href="DOE.html#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">592480</span>) <span class="sc">+</span></span>
<span id="cb105-8"><a href="DOE.html#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb105-9"><a href="DOE.html#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb105-10"><a href="DOE.html#cb105-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb105-11"><a href="DOE.html#cb105-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [Â°C]&quot;</span>,</span>
<span id="cb105-12"><a href="DOE.html#cb105-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikesmoothzoom-1.png" width="100%" /></p>
<p>On the other hand, when the temperature is coded as a factor we have the following coefficients and output calculation:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="DOE.html#cb106-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code> (Intercept) temperature2 temperature3 temperature4 
      551200        36200        74200       155800 </code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="DOE.html#cb108-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor<span class="sc">$</span>coefficients <span class="sc">%*%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>       [,1]
[1,] 587400</code></pre>
<p>The output is slightly different: 551â200 + 1 x 36â200 = 587â400, corresponding exactly to the treatment mean for 180Â°C. More on this in the next section.</p>
</div>
<div id="predict" class="section level3">
<h3>Predict</h3>
<p>A model is useful for predictions. In a random effects model where conclusions can be applied to the all the population we can predict values at any value of the input variables. In that case reusing the model with temperature as a numeric vector we could have a prediction for various temperature values such as:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="DOE.html#cb110-1" aria-hidden="true" tabindex="-1"></a>ebike_new <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">temperature =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">200</span>, <span class="dv">210</span>))</span>
<span id="cb110-2"><a href="DOE.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(ebike_lm, <span class="at">newdata =</span> ebike_new)</span></code></pre></div>
<pre><code>     1      2      3 
592480 643020 668290 </code></pre>
<p>As mentionned in our case the team has selected a fixed effects model and in principle they sould only draw conclusions at the levels at which the input was tested. We can check with <code>predict()</code> too that the predictions correspond exactly to the averages weâve calculated for each level:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="DOE.html#cb112-1" aria-hidden="true" tabindex="-1"></a>ebike_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">temperature =</span> <span class="fu">as_factor</span>(<span class="fu">c</span>(<span class="st">&quot;180&quot;</span>, <span class="st">&quot;200&quot;</span>)))</span>
<span id="cb112-2"><a href="DOE.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(ebike_lm_factor, <span class="at">newdata =</span> ebike_new)</span></code></pre></div>
<pre><code>     1      2 
587400 625400 </code></pre>
<p>We find again exactly the same values calculated using the matrix multiplication of the linear regression coefficients with the input vector we used before. The <code>predict()</code> function has other advantages such as providing confidence intervals and taking into account the correct contrast coding, which will be explored in later case studies.</p>
<p>The lab supervisor is now ready to assess the validity of the model. This is required before entering the main objective which is comparing the treatment means using an anova. To do this assessment the model he is going to do a residuals analysis. R provides direct plotting functions with the base and stats packages but he opted to break down the analysis and use custom the plots. He also uses some additional statistical tests to confirm our observations from the plots. He starts by loading the package broom which will help him retrieving the data from the lm object into a data frame.</p>
</div>
<div id="augment" class="section level3">
<h3>Model augment</h3>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="DOE.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="DOE.html#cb115-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(ebike_lm_factor) <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="DOE.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">row_number</span>())</span>
<span id="cb115-3"><a href="DOE.html#cb115-3" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb115-4"><a href="DOE.html#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-5"><a href="DOE.html#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">cycles</th>
<th align="center">temperature</th>
<th align="center">.fitted</th>
<th align="center">.resid</th>
<th align="center">.std.resid</th>
<th align="center">.hat</th>
<th align="center">.sigma</th>
<th align="center">.cooksd</th>
<th align="center">index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">575000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">23800</td>
<td align="center">1.45665</td>
<td align="center">0.2</td>
<td align="center">17571</td>
<td align="center">0.13261</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">542000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">-9200</td>
<td align="center">-0.56307</td>
<td align="center">0.2</td>
<td align="center">18679</td>
<td align="center">0.01982</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">530000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">-21200</td>
<td align="center">-1.29752</td>
<td align="center">0.2</td>
<td align="center">17846</td>
<td align="center">0.10522</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">539000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">-12200</td>
<td align="center">-0.74668</td>
<td align="center">0.2</td>
<td align="center">18535</td>
<td align="center">0.03485</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">570000</td>
<td align="center">160</td>
<td align="center">551200</td>
<td align="center">18800</td>
<td align="center">1.15063</td>
<td align="center">0.2</td>
<td align="center">18069</td>
<td align="center">0.08275</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">565000</td>
<td align="center">180</td>
<td align="center">587400</td>
<td align="center">-22400</td>
<td align="center">-1.37096</td>
<td align="center">0.2</td>
<td align="center">17724</td>
<td align="center">0.11747</td>
<td align="center">6</td>
</tr>
</tbody>
</table>
<div class="marginnote">
<p>Residuals analysis plots obtained with base R plot() function. In this unit each plot is generated individually with custom functions and a direct approach with based R is used in the next units.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="DOE.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb116-2"><a href="DOE.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ebike_lm_factor)</span></code></pre></div>
<p><img src="6_models_files/figure-html/unnamed-chunk-2-1.png" width="100%" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="DOE.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>() </span></code></pre></div>
<pre><code>null device 
          1 </code></pre>
</div>
<p>A deep structural change has happened in R since the <code>{tidyverse}</code>. The original S and R creators had developed a language where matrices, vectors, lists and dataframes had equivalent importance. The output of a function was often a list with a specific <em>S3</em> class comprising other vectors and data.frames inside. This allowed to use in a transparent way generic functions such as <code>summary()</code> to produce tailor made outputs because a method was working underneath. Weâve just seen an example of this with the <code>lm()</code> summary in the beginning of this case. For the <code>plot()</code> function there are more than a hundred different automatic plots as seens with <code>apropos("plot")</code>. This is a very important difference as in the <code>{tidyverse}</code> we add layers to obtain the required plot. On the data side since <code>{tidyverse}</code> has been introduced weâve seen an increasing importance of the dataframe, now replaced by the <code>tibble</code>. The <code>agument()</code> does exactly this, extracts the coefficients, residuals and other data from the model and stores it in a <code>tibble</code> format. This has the advantage of making it easier to integrate these functions with the other <code>{tidyverse}</code> functions and pipelines while still allowing to keep the methods approach. An interesting reading on this co-existance is available under <a href="https://www.tmwr.org/base-r.html#tidiness-modeling">tideness-modeling</a></p>
</div>
<div id="residuals_timeseries" class="section level3">
<h3>Timeseries plot</h3>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="DOE.html#cb119-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="DOE.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb119-3"><a href="DOE.html#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb119-4"><a href="DOE.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb119-5"><a href="DOE.html#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb119-6"><a href="DOE.html#cb119-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb119-7"><a href="DOE.html#cb119-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Residuals timeseries&quot;</span>,</span>
<span id="cb119-8"><a href="DOE.html#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Index&quot;</span>,</span>
<span id="cb119-9"><a href="DOE.html#cb119-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fitted vaues&quot;</span></span>
<span id="cb119-10"><a href="DOE.html#cb119-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikerestimeseries-1.png" width="100%" /></p>
<p>Before drawing conclusions on the significance of the input variables it is important to assess the validity of the model. The anova assumptions are similar to the t.test assumptions discussed before. In fact the anova can be considered extension of the t.test to factors with more than 2 levels. These assumptions are the common ones commining from statistical inference principles and the central limit theorem: independent and random samples, normality of the distributions, equality of variances. These assumptions could be checked in each variable group but this would be very time consuming and not fully robust. A better way is to analyse the model residuals which are the deviations of each datapoint from the linear regression line.</p>
<p>A first verification consists in confirming that the residuals have no patterns. This confirms that the sampling has been done randomly and there are none of the typical bias consisting in groups of values clustered from one operator the other or from one day to the other. This can be achieved with a residuals timeseries. If patterns emerge then there may be correlation in the residuals.</p>
<p>For this plot we need to ensure that the order of plotting in the x axis corresponds exactly to the original data collection order. In this case the lab supervisor confirms that no specific pattern emerges from the current plot and the design presents itself well randomised.</p>
</div>
<div id="autocorrelation" class="section level3">
<h3>Autocorrelation test</h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="DOE.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb120-2"><a href="DOE.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(ebike_lm_factor)</span></code></pre></div>
<pre><code> lag Autocorrelation D-W Statistic p-value
   1        -0.53433        2.9609    0.09
 Alternative hypothesis: rho != 0</code></pre>
<p>As already stated visual observations can most of the times be complemented with a statistical test. In this case we can apply the durbinWatson test from the <code>{car}</code> package (Car stands for Companion to Applied Regression)</p>
<p>Although the output shows Autocorrelation of -0.53 we have to consider that the p value is slightly higher than 0.05 thus there is not enough significance to say that there is autocorrelation. The result is not a complete clear cut the lab supervisor remains alert for coming verifications.</p>
</div>
<div id="normality-plot" class="section level3">
<h3>Normality plot</h3>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="DOE.html#cb122-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="DOE.html#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span></span>
<span id="cb122-3"><a href="DOE.html#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb122-4"><a href="DOE.html#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb122-5"><a href="DOE.html#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb122-6"><a href="DOE.html#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb122-7"><a href="DOE.html#cb122-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb122-8"><a href="DOE.html#cb122-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Linear model - qq plot&quot;</span>,</span>
<span id="cb122-9"><a href="DOE.html#cb122-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb122-10"><a href="DOE.html#cb122-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span></span>
<span id="cb122-11"><a href="DOE.html#cb122-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="6_models_files/figure-html/ebike-qqplot-1.png" width="100%" /></p>
<p>A good next check is to verify that the residuals are normaly distributed. As the sample size is relatively small it is better to use a qq plot instead of an histogram to assess the normality of the residuals. As we see on the plot values adhere to the straight line indicating an aproximately normal distribution. In the fixed effects model we give more importance to the center of the values and here we consider acceptable that the extremes of the data tend to bend away from the straight line. This verification can be completed by a normality test.</p>
</div>
<div id="shapiroTest" class="section level3">
<h3>Normality test</h3>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="DOE.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(ebike_aug<span class="sc">$</span>.resid)</span></code></pre></div>
<pre><code>
	Shapiro-Wilk normality test

data:  ebike_aug$.resid
W = 0.938, p-value = 0.22</code></pre>
<p>For populations &lt; 50 use the shapiro-wilk normality test, Here p &gt; 0.05 indicates that the residuals do not differ significantly from a normally distributed population.</p>
</div>
<div id="residuals_fit" class="section level3">
<h3>Residuals-Fit plot</h3>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="DOE.html#cb125-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="DOE.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb125-3"><a href="DOE.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb125-4"><a href="DOE.html#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> stats<span class="sc">::</span>loess, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb125-5"><a href="DOE.html#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb125-6"><a href="DOE.html#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb125-7"><a href="DOE.html#cb125-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb125-8"><a href="DOE.html#cb125-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Residuals vs Fitted values&quot;</span>,</span>
<span id="cb125-9"><a href="DOE.html#cb125-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb125-10"><a href="DOE.html#cb125-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span></span>
<span id="cb125-11"><a href="DOE.html#cb125-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikeresresfit-1.png" width="100%" /></p>
<p>If the model is correct and the assumptions hold, the residuals should be structureless. In particular they should be unrelated to any other variable including the predicted response. A plot of the residuals against the fitted values should reveal such structures. In this plot we see no variance anomalies such as a higher variance for a certain factor level or other types of skweness.</p>
</div>
<div id="std_residuals_fit" class="section level3">
<h3>Standard Residuals-Fit plot</h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="DOE.html#cb126-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="DOE.html#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> <span class="fu">abs</span>(.std.resid))) <span class="sc">+</span></span>
<span id="cb126-3"><a href="DOE.html#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb126-4"><a href="DOE.html#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> stats<span class="sc">::</span>loess, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-5"><a href="DOE.html#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb126-6"><a href="DOE.html#cb126-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Standardised Residuals vs Fitted values&quot;</span>,</span>
<span id="cb126-7"><a href="DOE.html#cb126-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Standardised Residuals&quot;</span>,</span>
<span id="cb126-8"><a href="DOE.html#cb126-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>)</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikestdresfit-1.png" width="100%" /></p>
<p>This Standardized residuals plot helps detecting outliers in the residuals (any residual &gt; 3 standard deviations is a potential outlier). The plot shows no outliers to consider in this DOE.</p>
</div>
<div id="std_residuals_factors" class="section level3">
<h3>Standard Residuals-Factor plot</h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="DOE.html#cb127-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="DOE.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(temperature), <span class="at">y =</span> .std.resid)) <span class="sc">+</span></span>
<span id="cb127-3"><a href="DOE.html#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb127-4"><a href="DOE.html#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> stats<span class="sc">::</span>loess, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-5"><a href="DOE.html#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb127-6"><a href="DOE.html#cb127-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Linear model - Standardised Residuals vs Factor levels&quot;</span>,</span>
<span id="cb127-7"><a href="DOE.html#cb127-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Standardised Residuals&quot;</span>,</span>
<span id="cb127-8"><a href="DOE.html#cb127-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Factor levels&quot;</span>)</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikestdresfactor-1.png" width="100%" /></p>
<p>Besides being another support to detect outliers, this additional plot also helps seeing if the variance of the residuals is identical in this case between the factor levels.</p>
</div>
<div id="homocedasticity" class="section level3">
<h3>Homocedasticity</h3>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="DOE.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bartlett.test</span>(cycles <span class="sc">~</span> temperature, <span class="at">data =</span> ebike_factor)</span></code></pre></div>
<pre><code>
	Bartlett test of homogeneity of variances

data:  cycles by temperature
Bartlett&#39;s K-squared = 0.433, df = 3, p-value = 0.93</code></pre>
<p>A complement to the residuals-fit/residuals-factors plots is the equality of variances test. Tests for variance comparison have been introduced in the Direct Comparisons case studies but the <code>var.test()</code> cannot be used here. Here we have more than two levels for which the Bartlett test is most suited. The normal distribution of the residuals has already been confirmed. This test is sensitive to the normality assumption, consequently, when the validity of this assumption is doubtful, it should not be used and be replaced by the modified Levene test for example. Applying the test we obtain a p-value is P = 0.93 meaning we cannot reject the null hypothesis. In statistical terms, there is no evidence to counter the claim that all five variances are the same. This is the same conclusion reached by analyzing the plot of residuals versus fitted values.</p>
</div>
<div id="outliers" class="section level3">
<h3>Outliers test</h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="DOE.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">outlierTest</span>(ebike_lm_factor)</span></code></pre></div>
<pre><code>No Studentized residuals with Bonferroni p &lt; 0.05
Largest |rstudent|:
   rstudent unadjusted p-value Bonferroni p
12   1.6488            0.11997           NA</code></pre>
<p>In a case where we were doubtfull we could go further and make a statistical test to assess if a certain value was an outlier. Another usefull test is available in the <code>{car}</code> package in this case to test outliers. We get a <em>Bonferroni</em> adjusted p value as NA confirming that there is no outlier in the data.</p>
</div>
<div id="cooks" class="section level3">
<h3>Cooks distance</h3>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="DOE.html#cb132-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="DOE.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb132-3"><a href="DOE.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>], <span class="at">fill =</span> <span class="st">&quot;grey90&quot;</span>) <span class="sc">+</span></span>
<span id="cb132-4"><a href="DOE.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb132-5"><a href="DOE.html#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb132-6"><a href="DOE.html#cb132-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Residuals vs Leverage&quot;</span>,</span>
<span id="cb132-7"><a href="DOE.html#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;Observation&quot;</span>,</span>
<span id="cb132-8"><a href="DOE.html#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="st">&quot;Cooks distance&quot;</span>)</span></code></pre></div>
<p><img src="6_models_files/figure-html/fig-ebikecooks-1.png" width="100%" /></p>
<p>Cooks distance is a complementary analysis to the residuals that can help identify specific data points that could have a strong influence in the model. Various cutoff points are suggested in the literature and we opted here for 1 following the short wikipedia article on the topic <a href="https://en.wikipedia.org/wiki/Cook&#39;s_distance">cooks distance</a></p>
</div>
<div id="R-squared" class="section level3">
<h3>R-squared</h3>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="DOE.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_lm_factor)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>[1] 0.92606</code></pre>
<p>A final input in the draft report of the ebike hardening linear model is the R-squared. When looking into the results the engineering team is suspicious. In this case 93% of the output is explained by input and a model with such a good fit should raise questions. Our lab supervisor is also not confortable the residuals analysis has not shown any evidence of something wrong with the model so he decides to quickly calculate it âby hand.â He knows that the R-squared, or coefficient of determination is obtained from the ratio between the residuals variance and the output variable variance showing exactly the proportion between the two and he gets its straight away from R using the data already available:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="DOE.html#cb135-1" aria-hidden="true" tabindex="-1"></a>ebike_aug <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="DOE.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cycles_var =</span> <span class="fu">var</span>(cycles), <span class="at">residuals_var =</span> <span class="fu">var</span>(.resid)) <span class="sc">%&gt;%</span></span>
<span id="cb135-3"><a href="DOE.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rsquared =</span> <span class="dv">1</span> <span class="sc">-</span> residuals_var<span class="sc">/</span>cycles_var) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Rsquared)</span></code></pre></div>
<pre><code>[1] 0.92606</code></pre>
<p>Remembering the original linear regression plot from the beginning of the report he accepts this must not be so far away. It was clear that the temperature had a strong impact on the number of cycles and the variability for each level was small in the end. He accepts to leave as it is for now waiting for upcoming analysis of variance to see additional details.</p>

</div>
</div>
<div id="effects-significance" class="section level2">
<h2>Effects significance</h2>
<p>The commercial introduction of the new e-bike model is approaching soon and production is expected to start in a couple of months. The engineering team is getting impacient because the parameters for the frame thermal treatment are not yet defined. The engineering head call for a second meeting to review once more the DoE outputs. The lab supervisor reopens his Rmd report tries to go beyond the linear model discussed before. He created raw data plots with dots on individual data points but now he thinks it is important to have a view on the data distribution and some summary statistics. For that he prepares a box plot:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="DOE.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb137-2"><a href="DOE.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  ebike_factor, </span>
<span id="cb137-3"><a href="DOE.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles, <span class="at">fill =</span> temperature)) <span class="sc">+</span></span>
<span id="cb137-4"><a href="DOE.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb137-5"><a href="DOE.html#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;D&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb137-6"><a href="DOE.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb137-7"><a href="DOE.html#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb137-8"><a href="DOE.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb137-9"><a href="DOE.html#cb137-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Raw data plot&quot;</span>,</span>
<span id="cb137-10"><a href="DOE.html#cb137-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [Â°C]&quot;</span>,</span>
<span id="cb137-11"><a href="DOE.html#cb137-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-3-1.png" width="100%" /></p>
<p>They have been doing so many experiments that sometimes it gets hard to remember which variables have been tested in which experiment. This plot reminds him that this test consisted simply on 1 input variable with severals levels - the temperature and one continuous dependent variable - the number of cycles to failure. The plots shows clearly that the distributes are quite appart from each other in spite of the slight overlap between the first three groups. The underlying question is: are the different levels of temperature explaining the different results in resistance to fatigue? to confirm that means of those groups are statistically different from each other he knows he can use the analysis of variance. The name is a bit misleading since he want to compare meansâ¦but this name is historical and comes from the way the approach has evolved. The anova as it is called is similar to the t-test but is extended. Using all pair wise t-tests would mean more effort and increase the type I error.</p>
<p>The anova main principle is that the the total variability in the data, as measured by the total corrected sum of squares, can be partitioned into a sum of squares of the differences between the treatment averages and the grand average plus a sum of squares of the differences of observations within treatments from the treatment average. The first time he read this explanation it seemed complex but he understood better on seeing a simple hand made example on the <a href="https://www.youtube.com/watch?v=EFdlFoHI_0I">kahn academy - anova</a>.</p>
<div id="aov" class="section level3">
<h3>Anova</h3>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="DOE.html#cb138-1" aria-hidden="true" tabindex="-1"></a>ebike_aov_factor <span class="ot">&lt;-</span> <span class="fu">aov</span>(ebike_lm_factor)</span>
<span id="cb138-2"><a href="DOE.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_aov_factor)</span></code></pre></div>
<pre><code>            Df   Sum Sq  Mean Sq F value  Pr(&gt;F)    
temperature  3 6.69e+10 2.23e+10    66.8 2.9e-09 ***
Residuals   16 5.34e+09 3.34e+08                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>In R the anova is built by passing the linear model object to the <code>anova()</code> or <code>aov()</code> functions. The output of the first is just the anova table, the output of the second function is a complete list with the full lm model inside.</p>
<p>The R anova output gives the Mean Square for the factor and for the residuals. In this case the between-treatment mean square is much larger than the within-treatment or residuals mean square. This suggests that it is unlikely that the treatment means are equal. The p is extremely small thus we have basis to reject the null hypothesis and conclude that the means are significantly different.
In the mean while the lab supervisor has gathered data on a similar experiment done with frams in another material for that seems to be less sensitive the the treatment temperation. He uploads this data and assigns it to a dataset called <code>ebike_hardning2</code> and plots another box plot.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="DOE.html#cb140-1" aria-hidden="true" tabindex="-1"></a>ebike_narrow2 <span class="ot">&lt;-</span> ebike_hardening2 <span class="sc">%&gt;%</span></span>
<span id="cb140-2"><a href="DOE.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb140-3"><a href="DOE.html#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;g&quot;</span>),</span>
<span id="cb140-4"><a href="DOE.html#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;observation&quot;</span>,</span>
<span id="cb140-5"><a href="DOE.html#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;cycles&quot;</span></span>
<span id="cb140-6"><a href="DOE.html#cb140-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb140-7"><a href="DOE.html#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature) <span class="sc">%&gt;%</span></span>
<span id="cb140-8"><a href="DOE.html#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cycles_mean =</span> <span class="fu">mean</span>(cycles)) <span class="sc">%&gt;%</span></span>
<span id="cb140-9"><a href="DOE.html#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb140-10"><a href="DOE.html#cb140-10" aria-hidden="true" tabindex="-1"></a>ebike_factor2 <span class="ot">&lt;-</span> ebike_narrow2</span>
<span id="cb140-11"><a href="DOE.html#cb140-11" aria-hidden="true" tabindex="-1"></a>ebike_factor2<span class="sc">$</span>temperature <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ebike_factor2<span class="sc">$</span>temperature)</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="DOE.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ebike_factor2, </span>
<span id="cb141-2"><a href="DOE.html#cb141-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles, <span class="at">fill =</span> temperature)) <span class="sc">+</span></span>
<span id="cb141-3"><a href="DOE.html#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb141-4"><a href="DOE.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb141-5"><a href="DOE.html#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb141-6"><a href="DOE.html#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb141-7"><a href="DOE.html#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb141-8"><a href="DOE.html#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb141-9"><a href="DOE.html#cb141-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Boxplot of frame aging resistance&quot;</span>,</span>
<span id="cb141-10"><a href="DOE.html#cb141-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [Â°C]&quot;</span>,</span>
<span id="cb141-11"><a href="DOE.html#cb141-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-6-1.png" width="100%" /></p>
<p>Effectively within group variation is larger and groups overlap more. A new anova gives a p value of 0.34 supporting the assumption of no significant difference between the means of the treatment levels.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="DOE.html#cb142-1" aria-hidden="true" tabindex="-1"></a>ebike_lm_factor2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cycles <span class="sc">~</span> temperature, <span class="at">data =</span> ebike_factor2)</span>
<span id="cb142-2"><a href="DOE.html#cb142-2" aria-hidden="true" tabindex="-1"></a>ebike_aov_factor2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(ebike_lm_factor2)</span>
<span id="cb142-3"><a href="DOE.html#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ebike_aov_factor2)</span></code></pre></div>
<pre><code>            Df   Sum Sq  Mean Sq F value Pr(&gt;F)
temperature  3 1.48e+09 4.92e+08     1.2   0.34
Residuals   16 6.55e+09 4.10e+08               </code></pre>
</div>
<div id="tukey" class="section level3">
<h3>Pairwise comparison</h3>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="DOE.html#cb144-1" aria-hidden="true" tabindex="-1"></a>ebike_tukey <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(ebike_aov_factor, <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="DOE.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_tukey<span class="sc">$</span>temperature) <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="DOE.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb145-3"><a href="DOE.html#cb145-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;tukey test on e-bike frame hardening process&quot;</span>, </span>
<span id="cb145-4"><a href="DOE.html#cb145-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-9">Table 6: </span>tukey test on e-bike frame hardening process</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">diff</th>
<th align="center">lwr</th>
<th align="center">upr</th>
<th align="center">p adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">180-160</td>
<td align="center">36200</td>
<td align="center">3145.6</td>
<td align="center">69254</td>
<td align="center">0.02943</td>
</tr>
<tr class="even">
<td align="left">200-160</td>
<td align="center">74200</td>
<td align="center">41145.6</td>
<td align="center">107254</td>
<td align="center">0.00005</td>
</tr>
<tr class="odd">
<td align="left">220-160</td>
<td align="center">155800</td>
<td align="center">122745.6</td>
<td align="center">188854</td>
<td align="center">0.00000</td>
</tr>
<tr class="even">
<td align="left">200-180</td>
<td align="center">38000</td>
<td align="center">4945.6</td>
<td align="center">71054</td>
<td align="center">0.02160</td>
</tr>
<tr class="odd">
<td align="left">220-180</td>
<td align="center">119600</td>
<td align="center">86545.6</td>
<td align="center">152654</td>
<td align="center">0.00000</td>
</tr>
<tr class="even">
<td align="left">220-200</td>
<td align="center">81600</td>
<td align="center">48545.6</td>
<td align="center">114654</td>
<td align="center">0.00001</td>
</tr>
</tbody>
</table>
<p>Back to the main test the lab supervisor wants to see if all levels are significantly different from each other. As discusses the anova indicates that there is a difference in the treament means but it wonât indicate which ones and doing individual t.tests has already been discarded. It is possible to get a direct one to one comparison of means with <code>TukeyHSD()</code> from <code>{stats}</code>. The test also provides a confidence interval for each difference. Most importantly it provides us with the p value to help us confirm the significance of the difference and conclude factor level by factor level which differences are significant. Additionally we can alo obtain the related plot with the confidence intervals</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="DOE.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ebike_tukey)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-10-1.png" width="100%" /></p>
<p>In the case of the frames thermal treatment all levels bring a specific impact on the lifecycle as we can see from the p values all below 0.05 and from the fact that no confidence interval crosses zero (there are no differences that could have a chance of being zero).</p>
</div>
<div id="fisherLSD" class="section level3">
<h3>Least significant difference</h3>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="DOE.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="DOE.html#cb148-1" aria-hidden="true" tabindex="-1"></a>ebike_LSD <span class="ot">&lt;-</span> <span class="fu">LSD.test</span>(</span>
<span id="cb148-2"><a href="DOE.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> ebike_lm_factor,</span>
<span id="cb148-3"><a href="DOE.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> <span class="st">&quot;temperature&quot;</span></span>
<span id="cb148-4"><a href="DOE.html#cb148-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>A useful complement to Tukeyâs test is the calculation of Fisherâs Least Significant differences. The Fisher procedure can be done in R with the <code>LSD.test()</code> from the <code>{agricolae}</code> package. The first important ouput is precisely the <em>least significant difference</em> which is the smallest the difference between means (of the the life cycles) that can be considered significant. This is indicated in the table below with the value LSD = 24â492.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="DOE.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_LSD<span class="sc">$</span>statistics) <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="DOE.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb149-3"><a href="DOE.html#cb149-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Fisher LSD procedure on e-bike frame hardening: stats&quot;</span>,</span>
<span id="cb149-4"><a href="DOE.html#cb149-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-13">Table 7: </span>Fisher LSD procedure on e-bike frame hardening: stats</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">MSerror</th>
<th align="center">Df</th>
<th align="center">Mean</th>
<th align="center">CV</th>
<th align="center">t.value</th>
<th align="center">LSD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="center">333700000</td>
<td align="center">16</td>
<td align="center">617750</td>
<td align="center">2.9571</td>
<td align="center">2.1199</td>
<td align="center">24492</td>
</tr>
</tbody>
</table>
<p>Furthermore it gives us a confidence intervals for each treatment level mean:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="DOE.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_LSD<span class="sc">$</span>means) <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="DOE.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Q25, <span class="sc">-</span>Q50, <span class="sc">-</span>Q75) <span class="sc">%&gt;%</span></span>
<span id="cb150-3"><a href="DOE.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb150-4"><a href="DOE.html#cb150-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Fisher LSD procedure on e-bike frame hardening: means&quot;</span>, </span>
<span id="cb150-5"><a href="DOE.html#cb150-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-14">Table 8: </span>Fisher LSD procedure on e-bike frame hardening: means</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">cycles</th>
<th align="center">std</th>
<th align="center">r</th>
<th align="center">LCL</th>
<th align="center">UCL</th>
<th align="center">Min</th>
<th align="center">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">160</td>
<td align="center">551200</td>
<td align="center">20017</td>
<td align="center">5</td>
<td align="center">533882</td>
<td align="center">568518</td>
<td align="center">530000</td>
<td align="center">575000</td>
</tr>
<tr class="even">
<td align="left">180</td>
<td align="center">587400</td>
<td align="center">16742</td>
<td align="center">5</td>
<td align="center">570082</td>
<td align="center">604718</td>
<td align="center">565000</td>
<td align="center">610000</td>
</tr>
<tr class="odd">
<td align="left">200</td>
<td align="center">625400</td>
<td align="center">20526</td>
<td align="center">5</td>
<td align="center">608082</td>
<td align="center">642718</td>
<td align="center">600000</td>
<td align="center">651000</td>
</tr>
<tr class="even">
<td align="left">220</td>
<td align="center">707000</td>
<td align="center">15248</td>
<td align="center">5</td>
<td align="center">689682</td>
<td align="center">724318</td>
<td align="center">685000</td>
<td align="center">725000</td>
</tr>
</tbody>
</table>
<p>We can see for example that for temperature 180 Â°C the lifecyle has an average of 587â400 (has he had calculated before) with a probability of 95% of being between 570â082 and and 604â718 cycles. Another useful outcome is the creation of groups of significance.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="DOE.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ebike_LSD<span class="sc">$</span>groups) <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="DOE.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>, </span>
<span id="cb151-3"><a href="DOE.html#cb151-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">&quot;Fisher LSD procedure on e-bike frame hardening: groups&quot;</span>, </span>
<span id="cb151-4"><a href="DOE.html#cb151-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> T)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-15">Table 9: </span>Fisher LSD procedure on e-bike frame hardening: groups</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">cycles</th>
<th align="center">groups</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">220</td>
<td align="center">707000</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="left">200</td>
<td align="center">625400</td>
<td align="center">b</td>
</tr>
<tr class="odd">
<td align="left">180</td>
<td align="center">587400</td>
<td align="center">c</td>
</tr>
<tr class="even">
<td align="left">160</td>
<td align="center">551200</td>
<td align="center">d</td>
</tr>
</tbody>
</table>
<p>In this case as all level means are statistically different they all show up in separate groups, each indicated by a specific letter. Finally we can use <code>plot()</code> which calls the method <code>plot.group()</code> from the same package. This allows us to provide as input the desired argument for the error bars.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="DOE.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb152-2"><a href="DOE.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  ebike_LSD, </span>
<span id="cb152-3"><a href="DOE.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">variation =</span> <span class="st">&quot;SE&quot;</span>, </span>
<span id="cb152-4"><a href="DOE.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;e-bike hardening</span><span class="sc">\n</span><span class="st">Means comparison&quot;</span></span>
<span id="cb152-5"><a href="DOE.html#cb152-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-16-1.png" width="100%" /></p>
<p>Strangly the package plot doesnât have the option to plot error bars with LSD and the lab supervisor decides to make a custom plot:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="DOE.html#cb153-1" aria-hidden="true" tabindex="-1"></a>ebike_factor <span class="sc">%&gt;%</span></span>
<span id="cb153-2"><a href="DOE.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature) <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="DOE.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cycles_mean =</span> <span class="fu">mean</span>(cycles), </span>
<span id="cb153-4"><a href="DOE.html#cb153-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">cycles_lsd =</span> ebike_LSD<span class="sc">$</span>statistics<span class="sc">$</span>LSD) <span class="sc">%&gt;%</span></span>
<span id="cb153-5"><a href="DOE.html#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> cycles_mean, <span class="at">color =</span> temperature)) <span class="sc">+</span></span>
<span id="cb153-6"><a href="DOE.html#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb153-7"><a href="DOE.html#cb153-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb153-8"><a href="DOE.html#cb153-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cycles_mean <span class="sc">-</span> cycles_lsd, </span>
<span id="cb153-9"><a href="DOE.html#cb153-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> cycles_mean <span class="sc">+</span> cycles_lsd),</span>
<span id="cb153-10"><a href="DOE.html#cb153-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb153-11"><a href="DOE.html#cb153-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">&quot;&#39;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb153-12"><a href="DOE.html#cb153-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb153-13"><a href="DOE.html#cb153-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 1xSD&quot;</span>, </span>
<span id="cb153-14"><a href="DOE.html#cb153-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb153-15"><a href="DOE.html#cb153-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb153-16"><a href="DOE.html#cb153-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;e-bike frame hardening process&quot;</span>,</span>
<span id="cb153-17"><a href="DOE.html#cb153-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Boxplot of frame aging resistance&quot;</span>,</span>
<span id="cb153-18"><a href="DOE.html#cb153-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Furnace Temperature [Â°C]&quot;</span>,</span>
<span id="cb153-19"><a href="DOE.html#cb153-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cycles to failure [n]&quot;</span>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-17-1.png" width="100%" /></p>
<p>The plot shows some overlap between the levels of 160 and 180 and again between 180 and 200. When looking a the Tukey test outcome we see that the p value of these differences is close to 0.05. Presenting all these statistical findings to the team they end up agreeing that in order to really improve the resistance they should consider a jump from 160 to 200Â°C in the thermal treatment.</p>
<p>As often with statistical tools, there is debate on the best approach to use. We recommend to combine the Tukey test with the Fisherâs LSD. The Tukey test giving a first indication of the levels that have an effect and calculating the means differences and the Fisher function to provide much more additional information on each level. To be considered in each situation the slight difference between the significance level for difference between means and to decide if required to take the most conservative one.</p>
<p>To go further in the Anova F-test we recommend this interesting article from <span class="citation"><a href="references.html#ref-minitab_anovaftest" role="doc-biblioref">Minitab</a> (<a href="references.html#ref-minitab_anovaftest" role="doc-biblioref">2016</a>)</span>.</p>
</div>
</div>
<div id="interactions" class="section level2">
<h2>Interactions</h2>
<div class="marginnote">
<p><b class="highlight">Case study: solarcell output test</b></p>
<p><img src="img/solar_cell_test_bw.jpg" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>The countdown to leave fossil fuel has started as many companies have adopted firm timelines for 100% renewable energy sourcing. Solar energy is a great candidate but solar cell efficiency is a great challenge. Although it has been progressing steadily since more than four decades yields can still be considered low. A global manufacturing company of solar cells is looking to push the boundaries with a new generation of materials and grab another pie of the global market.</p>
<div id="formula" class="section level3">
<h3>Model formulae</h3>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="DOE.html#cb154-1" aria-hidden="true" tabindex="-1"></a>solarcell_formula <span class="ot">&lt;-</span> <span class="fu">formula</span>(</span>
<span id="cb154-2"><a href="DOE.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  output <span class="sc">~</span> temperature <span class="sc">*</span> material</span>
<span id="cb154-3"><a href="DOE.html#cb154-3" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
<p>In previous case studies input factors has been put directly in the arguments of the <code>lm()</code> function by using the inputs and outputs and relating them with the tilde ~ sign. The cases were simple with only one factor but in most DoEs we want to have many factors and decide which interactions to keep or drop. Here weâre looking a bit more into detail in how to express this. When we pass an expression to the <code>formula()</code> function we generate an object of class formula and at that time some calculations are done in background to prepare the factors for the linear model calculation. Looking at the formula class and attributes we have:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="DOE.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(solarcell_formula)</span></code></pre></div>
<pre><code>[1] &quot;formula&quot;</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="DOE.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(<span class="fu">terms</span>(solarcell_formula))<span class="sc">$</span>factors</span></code></pre></div>
<pre><code>            temperature material temperature:material
output                0        0                    0
temperature           1        0                    1
material              0        1                    1</code></pre>
<p>We can see that the expression has been extended. Although we have only given as input the product of the factors we can see that an interaction term <code>temperature:material</code> has been generated. We also see the contrasts matrix associated. There is a specific syntax to specify the formula terms using <code>*</code>,<code>+</code> and other symbols. As always it is good to consult the function documentation with <code>?formula</code>.</p>
<p>In the solar cell manufacturing company mentioned before the R&amp;D team is working a new research project with the objective of understanding the output in [kWh/yr equivalent] of a new solar cell material at different ambient temperatures. Their latest experiment is recorded in an R dataset with the name <code>solarcell_output</code>:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="DOE.html#cb159-1" aria-hidden="true" tabindex="-1"></a>solarcell_output <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="DOE.html#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="DOE.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">material</th>
<th align="center">run</th>
<th align="center">T-10</th>
<th align="center">T20</th>
<th align="center">T50</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">thinfilm</td>
<td align="center">1</td>
<td align="center">130</td>
<td align="center">34</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="center">thinfilm</td>
<td align="center">2</td>
<td align="center">74</td>
<td align="center">80</td>
<td align="center">82</td>
</tr>
<tr class="odd">
<td align="center">thinfilm</td>
<td align="center">3</td>
<td align="center">155</td>
<td align="center">40</td>
<td align="center">70</td>
</tr>
<tr class="even">
<td align="center">thinfilm</td>
<td align="center">4</td>
<td align="center">180</td>
<td align="center">75</td>
<td align="center">58</td>
</tr>
<tr class="odd">
<td align="center">christaline</td>
<td align="center">1</td>
<td align="center">150</td>
<td align="center">136</td>
<td align="center">25</td>
</tr>
</tbody>
</table>
<p>As often this data comes in a wide format and the first step weâre doing is to convert it into a long format and to convert the variables to factors.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="DOE.html#cb160-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor <span class="ot">&lt;-</span> solarcell_output <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="DOE.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb160-3"><a href="DOE.html#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;T-10&quot;</span>, <span class="st">&quot;T20&quot;</span>, <span class="st">&quot;T50&quot;</span>),</span>
<span id="cb160-4"><a href="DOE.html#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;temperature&quot;</span>,</span>
<span id="cb160-5"><a href="DOE.html#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;output&quot;</span></span>
<span id="cb160-6"><a href="DOE.html#cb160-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(material, temperature), as_factor))</span></code></pre></div>
<p>The experiment has consisted in measuring the output at three different temperature levels on three different materials. The associated linear model can be obtained with:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="DOE.html#cb161-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb161-2"><a href="DOE.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> solarcell_formula, </span>
<span id="cb161-3"><a href="DOE.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> solarcell_factor</span>
<span id="cb161-4"><a href="DOE.html#cb161-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb161-5"><a href="DOE.html#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_factor_lm)</span></code></pre></div>
<pre><code>
Call:
lm(formula = solarcell_formula, data = solarcell_factor)

Residuals:
   Min     1Q Median     3Q    Max 
-60.75 -14.63   1.38  17.94  45.25 

Coefficients:
                                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                            134.75      12.99   10.37  6.5e-11 ***
temperatureT20                         -77.50      18.37   -4.22  0.00025 ***
temperatureT50                         -77.25      18.37   -4.20  0.00026 ***
materialchristaline                     21.00      18.37    1.14  0.26311    
materialmultijunction                    9.25      18.37    0.50  0.61875    
temperatureT20:materialchristaline      41.50      25.98    1.60  0.12189    
temperatureT50:materialchristaline     -29.00      25.98   -1.12  0.27424    
temperatureT20:materialmultijunction    79.25      25.98    3.05  0.00508 ** 
temperatureT50:materialmultijunction    18.75      25.98    0.72  0.47676    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 26 on 27 degrees of freedom
Multiple R-squared:  0.765,	Adjusted R-squared:  0.696 
F-statistic:   11 on 8 and 27 DF,  p-value: 9.43e-07</code></pre>
<p>Weâre going to go more in details now to validate the model and understand the effects and interactions of the different factors.</p>
</div>
<div id="RSE" class="section level3">
<h3>Residuals standard error</h3>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="DOE.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pluck</span>(<span class="fu">summary</span>(solarcell_factor_lm), <span class="st">&quot;sigma&quot;</span>)</span></code></pre></div>
<pre><code>[1] 25.985</code></pre>
<p>Besides the R-squared discussed previously in the linear models unit there is another useful indicator of the quality of the fit which is the Residuals Standard Error RSE. It provides the magnitude of a typical residuals. This value is also given directly as output of the model summary and is 26 in this case. Like the R-squared is better when we know how it is calculated and once weâre at ease with manipulating the model data either with <code>{stats}</code> or <code>{broom}</code> it is possible to with a few steps check see how this is done.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="DOE.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">sum</span>(solarcell_factor_lm<span class="sc">$</span>residuals <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">df.residual</span>(solarcell_factor_lm))</span></code></pre></div>
<pre><code>[1] 25.985</code></pre>
<p>The exact value is 25.985 confirming the value extracted from the summary with the <code>pluck()</code> function from <code>{purrr}</code>.</p>
</div>
<div id="plot.lm" class="section level3">
<h3>Residuals summary</h3>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="DOE.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb167-2"><a href="DOE.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm<span class="sc">$</span>residuals)</span>
<span id="cb167-3"><a href="DOE.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb167-4"><a href="DOE.html#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb167-5"><a href="DOE.html#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm, <span class="at">which =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-26-1.png" width="100%" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="DOE.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>() </span></code></pre></div>
<pre><code>null device 
          1 </code></pre>
<p>As the residuals analysis has been discussed in detail including custom made plots and statistical tests in the linear models unit, the assessment is done here in a summarized manner with a grouped output of all residuals plots. The qq plot presents good adherence to the center line indicating a normal distribution; the residuals versus fit presents a rather symmetrical distribution around zero indicating equality of variances at all levels and; the scale location plot though, shows a center line that is not horizontal which suggests the presence of outliers; in the Residuals versus fit we can effectively sense the Residuals Standard Error of 26.</p>
</div>
<div id="interaction.plot" class="section level3">
<h3>Interaction plot</h3>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="DOE.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(</span>
<span id="cb170-2"><a href="DOE.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb170-3"><a href="DOE.html#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>],</span>
<span id="cb170-4"><a href="DOE.html#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.factor =</span> solarcell_factor<span class="sc">$</span>temperature,</span>
<span id="cb170-5"><a href="DOE.html#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.factor =</span> solarcell_factor<span class="sc">$</span>material,</span>
<span id="cb170-6"><a href="DOE.html#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> mean,</span>
<span id="cb170-7"><a href="DOE.html#cb170-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> solarcell_factor<span class="sc">$</span>output,</span>
<span id="cb170-8"><a href="DOE.html#cb170-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.label =</span> <span class="st">&quot;Material&quot;</span>,</span>
<span id="cb170-9"><a href="DOE.html#cb170-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb170-10"><a href="DOE.html#cb170-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Temperature-Material interaction plot&quot;</span>,</span>
<span id="cb170-11"><a href="DOE.html#cb170-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;temperature [Â°C]&quot;</span>,</span>
<span id="cb170-12"><a href="DOE.html#cb170-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;output [kWh/yr equivalent]&quot;</span></span>
<span id="cb170-13"><a href="DOE.html#cb170-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-27-1.png" width="100%" /></p>
<p>In order to understand the behavior of the solar cell materials in the different temperature conditions the R&amp;D team is looking for a plot that presents both factors simultaneous. Many different approaches are possible in R and here the team has selected the most basic one, the <code>interactionplot()</code> from the <code>{stats}</code> package.</p>
<p>Although simple several findings can already be extracted from this plot. They get the indication of the mean value of the solar cell output for the different materials at each temperature level. Also we see immediately that batteries tend to last longer at lower temperatures and this for all material types. We also see that there is certainly an interaction between material and temperature as the lines cross each other.</p>
</div>
<div id="anova" class="section level3">
<h3>Anova with interactions</h3>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="DOE.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(solarcell_factor_lm)</span></code></pre></div>
<pre><code>Analysis of Variance Table

Response: output
                     Df Sum Sq Mean Sq F value  Pr(&gt;F)    
temperature           2  39119   19559   28.97 1.9e-07 ***
material              2  10684    5342    7.91   0.002 ** 
temperature:material  4   9614    2403    3.56   0.019 *  
Residuals            27  18231     675                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Continuing the analysis started in the interaction plot the R&amp;D team checks the anova output. Like in the lm summary output, the stars in front of the p value of the different factors indicate that the effects are statistically different. Three stars for temperature corresponding to an extremely low p value indicating that the means of the output at the different levels of temperature are different. This confirms that temperature has an effect on output power. The material effect has a lower significance but is also clearly impacting cell power output. Finally it is confirmed that there is an interaction between temperature and material as the temperature:material term has a p value of 0.019 which is lower than the typical threshold of 0.05. Looking into the details interaction comes from the fact that increasing temperature from 10 to 20 decreases output for the thinfilm but is not yet impacting the output for multijunction film. For multijunction it is needed to increase even further the temperature to 50Â°C to see the decrease in the output.</p>
<p>Before closing the first DOE analysis meeting the R&amp;D team discusses what would have been take-aways if the interaction had not put in the model. As they use more and more R during their meetings and do the data analysis on the sport they simply create another model without the temperature:material term in the formula:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="DOE.html#cb173-1" aria-hidden="true" tabindex="-1"></a>solarcell_factor_lm_no_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb173-2"><a href="DOE.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  output <span class="sc">~</span> temperature <span class="sc">+</span> material, </span>
<span id="cb173-3"><a href="DOE.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> solarcell_factor)</span>
<span id="cb173-4"><a href="DOE.html#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_factor_lm_no_int)</span></code></pre></div>
<pre><code>
Call:
lm(formula = output ~ temperature + material, data = solarcell_factor)

Residuals:
   Min     1Q Median     3Q    Max 
-54.39 -21.68   2.69  17.22  57.53 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              122.5       11.2   10.97  3.4e-12 ***
temperatureT20           -37.2       12.2   -3.04   0.0047 ** 
temperatureT50           -80.7       12.2   -6.59  2.3e-07 ***
materialchristaline       25.2       12.2    2.06   0.0482 *  
materialmultijunction     41.9       12.2    3.43   0.0017 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 30 on 31 degrees of freedom
Multiple R-squared:  0.641,	Adjusted R-squared:  0.595 
F-statistic: 13.9 on 4 and 31 DF,  p-value: 1.37e-06</code></pre>
<p>Residual standard error is up from 26 to 30 which shows a poorer fit but R-square is only down from 76.5% to 64.1% which is still reasonably high. They apply the anova on this new model:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="DOE.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(solarcell_factor_lm_no_int)</span></code></pre></div>
<pre><code>Analysis of Variance Table

Response: output
            Df Sum Sq Mean Sq F value  Pr(&gt;F)    
temperature  2  39119   19559   21.78 1.2e-06 ***
material     2  10684    5342    5.95  0.0065 ** 
Residuals   31  27845     898                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The output still confirms the significance of the effects of the factors but the residuals analysis raises other concerns:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="DOE.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb177-2"><a href="DOE.html#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm_no_int<span class="sc">$</span>residuals)</span>
<span id="cb177-3"><a href="DOE.html#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm_no_int, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb177-4"><a href="DOE.html#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm_no_int, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb177-5"><a href="DOE.html#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solarcell_factor_lm_no_int, <span class="at">which =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-31-1.png" width="100%" /></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="DOE.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>null device 
          1 </code></pre>
<p>They see in the Residuals vs Fitted a clear pattern with residuals moving from positive to negative and then again to positive along the fitted values axis which indicates that there is an interaction at play. Another concern comes from the Residuals versus Factor levels where at 10Â°C some residuals go beyond 2 standard deviations. The model with the interaction is clearly preferred in this case.</p>
</div>
</div>
<div id="covariance" class="section level2">
<h2>Covariance</h2>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="DOE.html#cb180-1" aria-hidden="true" tabindex="-1"></a>solarcell_fill <span class="sc">%&gt;%</span> </span>
<span id="cb180-2"><a href="DOE.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb180-3"><a href="DOE.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">material</th>
<th align="right">output</th>
<th align="right">fillfactor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">multijunction_A</td>
<td align="right">108</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">multijunction_A</td>
<td align="right">123</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td align="left">multijunction_A</td>
<td align="right">117</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">multijunction_A</td>
<td align="right">126</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td align="left">multijunction_A</td>
<td align="right">147</td>
<td align="right">32</td>
</tr>
</tbody>
</table>
<p>Solarcell experiments continue as the R&amp;D project on new materials progresses. Any increase in the output, which is measured in [kWh/yr equivalent will bring a competitive advantage to the company. The previous meeting outcome made the R&amp;D team select the multijunction material as the best candidate for the next round of tests. A new experiment has been designed but the team needs to go deeper in the understanding on how to improve the power output. Besides temperature and material there seems to be another variable at play: the fill factor. This seems to be a complex technical topic but all experts agree that this is influencing the behavior of the cell. The fill factor depends on the electrical circuit configuration and the output seems to be correlated with it. Until now the team has not been able to control the fill factor. The table just presented shows the value of fill factor collected for each cell tested together with the measured output.</p>
<p>A Data Scientist from the center recommends to use an analysis of covariance (ancova) which can be useful in situations where a continuous variable may be influencing the measured value. He calls this a covariate. In such specific case this approach provides better results than the analysis of variance (anova) allowing for a more accurate assessment of the effects of the categorical variable. In this case it can remove the effect of the fill factor in the output when we want to compare the different materials. It is nevetheless important to ensure the basic assumption that the continuous variable is independent from the factor to be analyses, in this case that the material is not influencing the fill factor. A good explanation and a similar case (without R) can be seen on page 655 of <span class="citation"><a href="references.html#ref-Montgomery2012" role="doc-biblioref">Montgomery</a> (<a href="references.html#ref-Montgomery2012" role="doc-biblioref">2012</a>)</span>.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="DOE.html#cb181-1" aria-hidden="true" tabindex="-1"></a>solarcell_fill <span class="sc">%&gt;%</span></span>
<span id="cb181-2"><a href="DOE.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fillfactor, <span class="at">y =</span> output)) <span class="sc">+</span></span>
<span id="cb181-3"><a href="DOE.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb181-4"><a href="DOE.html#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb181-5"><a href="DOE.html#cb181-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb181-6"><a href="DOE.html#cb181-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb181-7"><a href="DOE.html#cb181-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;The solarcell output test&quot;</span>,</span>
<span id="cb181-8"><a href="DOE.html#cb181-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Output vs Fill Factor&quot;</span>,</span>
<span id="cb181-9"><a href="DOE.html#cb181-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fill factor [%]&quot;</span>,</span>
<span id="cb181-10"><a href="DOE.html#cb181-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Output&quot;</span></span>
<span id="cb181-11"><a href="DOE.html#cb181-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-33-1.png" width="100%" /></p>
<div id="cor.test" class="section level3">
<h3>Correlation test</h3>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="DOE.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(</span>
<span id="cb182-2"><a href="DOE.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  solarcell_fill<span class="sc">$</span>output, solarcell_fill<span class="sc">$</span>fillfactor,</span>
<span id="cb182-3"><a href="DOE.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span></span>
<span id="cb182-4"><a href="DOE.html#cb182-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>
	Pearson&#39;s product-moment correlation

data:  solarcell_fill$output and solarcell_fill$fillfactor
t = 9.8, df = 13, p-value = 2.3e-07
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.82100 0.97976
sample estimates:
    cor 
0.93854 </code></pre>
<p>The next step is to confirm the correlation between the continuous input variable and the output and the <code>cor.test()</code> from the <code>{stats}</code> package is perfectly suited for this. The extremely high value of 93% confirms what was very visible in the scatterplot. Going further and using the approach from <span class="citation">(<a href="references.html#ref-Broc2016" role="doc-biblioref">Broc 2016</a>)</span> weâre going to facet the scatterplots to assess if the coefficient of the linear regression is similar for all the levels of the fillfactor:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="DOE.html#cb184-1" aria-hidden="true" tabindex="-1"></a>solarcell_fill <span class="sc">%&gt;%</span></span>
<span id="cb184-2"><a href="DOE.html#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fillfactor, <span class="at">y =</span> output)) <span class="sc">+</span></span>
<span id="cb184-3"><a href="DOE.html#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb184-4"><a href="DOE.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb184-5"><a href="DOE.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(material)) <span class="sc">+</span></span>
<span id="cb184-6"><a href="DOE.html#cb184-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_industRial</span>() <span class="sc">+</span></span>
<span id="cb184-7"><a href="DOE.html#cb184-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb184-8"><a href="DOE.html#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;The solarcell output test&quot;</span>,</span>
<span id="cb184-9"><a href="DOE.html#cb184-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Output vs Fill Factor, by material type&quot;</span>,</span>
<span id="cb184-10"><a href="DOE.html#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Fill factor [%]&quot;</span>,</span>
<span id="cb184-11"><a href="DOE.html#cb184-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Output&quot;</span></span>
<span id="cb184-12"><a href="DOE.html#cb184-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="7_effects_files/figure-html/unnamed-chunk-35-1.png" width="100%" /></p>
<p>The linear regression plots split by material show that from one material to the other the relationship between output and fillfactor is equivalent. Not only increasing fill factor increase output the degree to which this takes place is similar as we can see by the slopes of the plot. Care needs to be taken because the number of points is very small. If required it is always possible to do individual correlation test and/or do a statistical test between slopes. Now things are ready to the ancova itself.</p>
</div>
<div id="ancova_aov" class="section level3">
<h3>Ancova</h3>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="DOE.html#cb185-1" aria-hidden="true" tabindex="-1"></a>solarcell_ancova <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb185-2"><a href="DOE.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> output <span class="sc">~</span> fillfactor <span class="sc">+</span> material, </span>
<span id="cb185-3"><a href="DOE.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> solarcell_fill</span>
<span id="cb185-4"><a href="DOE.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb185-5"><a href="DOE.html#cb185-5" aria-hidden="true" tabindex="-1"></a>solarcell_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb185-6"><a href="DOE.html#cb185-6" aria-hidden="true" tabindex="-1"></a>  output <span class="sc">~</span> material, </span>
<span id="cb185-7"><a href="DOE.html#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> solarcell_fill</span>
<span id="cb185-8"><a href="DOE.html#cb185-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Although the team had been using R often the case of the ancova had not yet came up so it was up to the Data Scientist to do this analysis. In R the ancova can be done with the same function as the anova, the <code>aov()</code> function from <code>{stats}</code> but thereâs a specific way to establish the formula which he has obtained from <a href="https://www.datanovia.com/en/lessons/ancova-in-r/">Datanovia - Ancova</a>: the covariate is the first input and there must be interaction between the two inputs, thus the plus sign only. As with contrasts, any little mistake in the syntax may produce very different results so it requires great care and often confirmation of calculation with an existing well know case.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="DOE.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_ancova)</span></code></pre></div>
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
fillfactor   1   2746    2746  119.93  3e-07 ***
material     2    120      60    2.61   0.12    
Residuals   11    252      23                   
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="DOE.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(solarcell_aov)</span></code></pre></div>
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)  
material     2   1264     632    4.09  0.044 *
Residuals   12   1854     155                 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The <code>aov()</code> summary output looks exactly the same for both analysis but the in the first output corresponding to the ancova the material mean square has been adjusted for regression and is smaller. It is also noticeable that the residuals are smaller in the ancova which confirm that the approach has helped reducing the error variability.</p>
<p>Finaly the most important observation is that the conclusions would have been just the opposite if the Data Scientist had not recommended the ancova. In fact in the anova would have shown that the material influences the output while when removing the influence of the fill factor the ancova ends up showing that there is no influence. This is visible in the p value which is above 0.05 in the ancova and below 0.05 in the anova.</p>
<p>As next steps the R&amp;D team decides to tackle this fill factor issue and get it into control. Reducing fill factor variability within each material will certainly reduce the variability in the power output. I would also make upcoming experiments simpler and more easily comparable.</p>

</div>
</div>
<div id="general-designs" class="section level2">
<h2>General designs</h2>
<p>General factorial designs require teams to put together a wealth of knowledge of which some has been already applied in previous case studies or is referred in the bibliography and glossary. This comprises things like root cause analysis, linear models and analysis of variance all coherently articulated in a well though project with clear objectives. The building blocks discussed so far relate to a limited number of input factors and levels and exclusively a single output variable. Model validation and interactions are needed tools in all cases and once these are all mastered it becomes possible to consider situations with many variables, many outputs and higher level interactions. These arrangements become extremely powerful and allow to handle complex real life situations such as the design of a new system with dozens of features that relate with each other or the optimization of a manufacturing process where the amount of data generated is very large but the testing time and cost are very high. At this moment considerations of trial quantities optimization enter at play.</p>
<p>In our case studies a <em>run</em> represents a unique combination of the factors and a <em>replicate</em> an independent repetition of a run. This leads to the notion of <em>trials</em> corresponding to the multiplication of the number of runs by the number of replicates. For small designs it is possible to calculate the number of trials by simply multiplying the number of levels of each factor. If we have for instance 1 factor with 3 levels and 2 factors with 4 levels then we have <span class="math inline">\(3 \times 4 \times 4 = 48\)</span> runs which corresponds to the number of distinct combinations. Then we have to multiply by the number of replicates per run to get the number of trials, e.g <span class="math inline">\(48 \times 3 = 144\)</span> trials.</p>
<p>For a very high number of factors and levels where this way of calculating may not be practical the total number of trials is given by <span class="math inline">\(l^k\)</span> where <span class="math inline">\(l\)</span> is the number of levels and <span class="math inline">\(k\)</span> the number of input factors. With this approach a design with 4 factors of 2 levels gives <span class="math inline">\(2^4 = 2 \times 2 \times 2 \times 2 = 16\)</span> runs and if each has 5 replicates there are <span class="math inline">\(16 \times 5 = 80\)</span> trials to be executed. If more factors with a different number of levels are added, the total number of trials is calculated by multiplying both groups: <span class="math inline">\(l_{1}^{k_{1}}\)</span> <span class="math inline">\(\times\)</span> <span class="math inline">\(l_{2}^{k_{2}}\)</span>. Continuing the previous example, if 3 additional factors with 4 levels each were added, all with 5 replicates, the total number of trials would be expressed as follows: <span class="math inline">\(2^{4} \times 4^{3} \times 5 = 5120\)</span> trials, which is a very high number in most industrial cases and would require optimization techniques which will be discussed in later units.</p>
<div id="fac.design" class="section level3">
<h3>Factorial design</h3>
<div class="marginnote">
<p><b class="highlight">Case study: juice bottling plant</b></p>
<p>In a juice producing plant a new fast dry matter content measurement device from the supplier DRX has been recently put in operation but the Quality Assurance Head has raised concerns on a bias with the reference method. The quality team established DoE to assess several potential causes such as the dry matter content and juice residue particle size.</p>
<p><img src="img/juice_bottling_bw2.jpg" width="100%" /></p>
</div>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="DOE.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoE.base)</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="DOE.html#cb191-1" aria-hidden="true" tabindex="-1"></a>juice_doe <span class="ot">&lt;-</span> <span class="fu">fac.design</span>(</span>
<span id="cb191-2"><a href="DOE.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb191-3"><a href="DOE.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">factor.names =</span> <span class="fu">list</span>(</span>
<span id="cb191-4"><a href="DOE.html#cb191-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">c</span>(<span class="st">&quot;beetroot&quot;</span>, <span class="st">&quot;apple&quot;</span>, <span class="st">&quot;carrot&quot;</span>), </span>
<span id="cb191-5"><a href="DOE.html#cb191-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">drymatter_target =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>),</span>
<span id="cb191-6"><a href="DOE.html#cb191-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">part =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb191-7"><a href="DOE.html#cb191-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">25</span>),</span>
<span id="cb191-8"><a href="DOE.html#cb191-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">particle_size =</span> <span class="fu">c</span>(<span class="dv">250</span>, <span class="dv">300</span>))</span>
<span id="cb191-9"><a href="DOE.html#cb191-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Although the Calibration essay discussed in the MSA unit has shown a bias during the acceptance phase the Factory Management has opted to put it in production. The reduction in measurement time is significant and Supply Chain is putting pressure to increase volumes in a context where on-line sales rocket sky high. The Quality Manager understands all this but heâs concern of having some kind of kickback. Although heâs not expecting any kind of consumer complain, dry matter levels are somehow loosely related with some sort claims and regulatory limits.</p>
<p>To dig deeper and understand how to minimize this bias he has asked one of his team members to come up with an experiment design. He would like something that combines all factors mentionned by the team as potential root causes for the bias. After a short brainstorming between the production and quality teams several potential causes for bias were: drymatter level, the speed of filling and the powder particle size. This lead to a mid size experiment design with three products, three levels of drymatter, two line speed levels and two particle size levels.</p>
<p>When the number of factors and levels is limited it is possible to reccur to existing experiment designs and pre-filled <em>Yates tables</em>. In this case the quality analyst had been trying with R and found a package called <code>{DoE.base}</code> which generates such designs automatically with the function <code>fac.desig</code>. The output generated by this function is more than just a tibble, it belongs to a specific class called <code>design</code>and has other attributes just like an lm or aov S3 objects. The care given by the package authors becomes visible when using an R generic function such as <code>summary()</code> with such object and get as return a tailor made output, in this case showing the levels of the different factors of our design:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="DOE.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(juice_doe)</span></code></pre></div>
<pre><code>[1] &quot;design&quot;     &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="DOE.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(juice_doe)</span></code></pre></div>
<pre><code>Call:
fac.design(randomize = FALSE, factor.names = list(product = c(&quot;beetroot&quot;, 
    &quot;apple&quot;, &quot;carrot&quot;), drymatter_target = c(10, 15, 20), part = c(1, 
    2, 3), speed = c(20, 25), particle_size = c(250, 300)))

Experimental design of type  full factorial 
108  runs

Factor settings (scale ends):
   product drymatter_target part speed particle_size
1 beetroot               10    1    20           250
2    apple               15    2    25           300
3   carrot               20    3                    </code></pre>
<p>In the summary() output we can see the plan factors with 3 products, 3 levels of dry matter target, 2 levels for speed and 2 levels for particle size. Using this the team has simple copied the experiment plan to an spreadsheet to collect the data:</p>
<pre><code>juice_doe %&gt;% 
  write_clip() </code></pre>
<p>and after a few days the file completed with the test results cames back ready for analysis</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="DOE.html#cb197-1" aria-hidden="true" tabindex="-1"></a>juice_drymatter <span class="sc">%&gt;%</span></span>
<span id="cb197-2"><a href="DOE.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb197-3"><a href="DOE.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">product</th>
<th align="right">drymatter_TGT</th>
<th align="right">speed</th>
<th align="right">particle_size</th>
<th align="right">part</th>
<th align="right">drymatter_DRX</th>
<th align="right">drymatter_REF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">apple</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">1</td>
<td align="right">9.80</td>
<td align="right">10.05</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">2</td>
<td align="right">9.82</td>
<td align="right">10.05</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">3</td>
<td align="right">9.82</td>
<td align="right">10.05</td>
</tr>
<tr class="even">
<td align="left">beetroot</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">1</td>
<td align="right">9.79</td>
<td align="right">10.03</td>
</tr>
<tr class="odd">
<td align="left">beetroot</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">2</td>
<td align="right">9.75</td>
<td align="right">10.03</td>
</tr>
<tr class="even">
<td align="left">beetroot</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">250</td>
<td align="right">3</td>
<td align="right">9.77</td>
<td align="right">10.03</td>
</tr>
</tbody>
</table>
<p>and the only thing quality analyst had to add was an extra column to calculate the bias:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="DOE.html#cb198-1" aria-hidden="true" tabindex="-1"></a>juice_drymatter <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span></span>
<span id="cb198-2"><a href="DOE.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bias =</span> drymatter_DRX <span class="sc">-</span> drymatter_REF)</span></code></pre></div>
</div>
<div id="main_effects" class="section level3">
<h3>Main effects plots</h3>
<div class="marginnote">
<div class="figure"><span id="fig:unnamed-chunk-7"></span>
<img src="8_generalDOEs_files/figure-html/unnamed-chunk-7-1.png" alt="Main" width="100%" />
<p class="caption">
Figure 1: Main
</p>
</div>
</div>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="DOE.html#cb199-1" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span></span>
<span id="cb199-2"><a href="DOE.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drymatter_TGT) <span class="sc">%&gt;%</span></span>
<span id="cb199-3"><a href="DOE.html#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">bias_m_drymatter =</span> <span class="fu">mean</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb199-4"><a href="DOE.html#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drymatter_TGT, <span class="at">y =</span> bias_m_drymatter)) <span class="sc">+</span></span>
<span id="cb199-5"><a href="DOE.html#cb199-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb199-6"><a href="DOE.html#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb199-7"><a href="DOE.html#cb199-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb199-8"><a href="DOE.html#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">21</span>),</span>
<span id="cb199-9"><a href="DOE.html#cb199-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb199-10"><a href="DOE.html#cb199-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb199-11"><a href="DOE.html#cb199-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Juice bottling problem&quot;</span>,</span>
<span id="cb199-12"><a href="DOE.html#cb199-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Main effects plots&quot;</span>,</span>
<span id="cb199-13"><a href="DOE.html#cb199-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Drymatter TGT [%]&quot;</span>,</span>
<span id="cb199-14"><a href="DOE.html#cb199-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias [g]&quot;</span></span>
<span id="cb199-15"><a href="DOE.html#cb199-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>As the number of factors and levels of a design increase, more thinking is required to obtain good visualisation of the data. Main effects plots consist usually of a scatterplot representing the experiment output as a function of one of the inputs. This first plot consists of the mean bias as a function of the dry matter for each of the 3 levels tested. As the DOE has 3 factors, three plots like this are required in total. The Quality Analyst builds the remaining two plots and then groups them all together in a single output with the package <code>{patchwork}</code>. This is made by simply putting <code>+</code> between the plots.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="DOE.html#cb200-1" aria-hidden="true" tabindex="-1"></a>particle_size_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb200-2"><a href="DOE.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(particle_size) <span class="sc">%&gt;%</span></span>
<span id="cb200-3"><a href="DOE.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">particle_size_bias_mean =</span> <span class="fu">mean</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb200-4"><a href="DOE.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> particle_size, <span class="at">y =</span> particle_size_bias_mean)) <span class="sc">+</span></span>
<span id="cb200-5"><a href="DOE.html#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb200-6"><a href="DOE.html#cb200-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb200-7"><a href="DOE.html#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb200-8"><a href="DOE.html#cb200-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">240</span>,<span class="dv">310</span>), </span>
<span id="cb200-9"><a href="DOE.html#cb200-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb200-10"><a href="DOE.html#cb200-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb200-11"><a href="DOE.html#cb200-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Particle Size&quot;</span>,</span>
<span id="cb200-12"><a href="DOE.html#cb200-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias [g]&quot;</span></span>
<span id="cb200-13"><a href="DOE.html#cb200-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb200-14"><a href="DOE.html#cb200-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-15"><a href="DOE.html#cb200-15" aria-hidden="true" tabindex="-1"></a>speed_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb200-16"><a href="DOE.html#cb200-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speed) <span class="sc">%&gt;%</span></span>
<span id="cb200-17"><a href="DOE.html#cb200-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">speed_bias_mean =</span> <span class="fu">mean</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb200-18"><a href="DOE.html#cb200-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> speed_bias_mean)) <span class="sc">+</span></span>
<span id="cb200-19"><a href="DOE.html#cb200-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb200-20"><a href="DOE.html#cb200-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb200-21"><a href="DOE.html#cb200-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb200-22"><a href="DOE.html#cb200-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">26</span>),</span>
<span id="cb200-23"><a href="DOE.html#cb200-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb200-24"><a href="DOE.html#cb200-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb200-25"><a href="DOE.html#cb200-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Speed&quot;</span>,</span>
<span id="cb200-26"><a href="DOE.html#cb200-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias [g]&quot;</span></span>
<span id="cb200-27"><a href="DOE.html#cb200-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb200-28"><a href="DOE.html#cb200-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-29"><a href="DOE.html#cb200-29" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_plot <span class="sc">+</span> particle_size_plot <span class="sc">+</span> speed_plot</span></code></pre></div>
<p><img src="8_generalDOEs_files/figure-html/unnamed-chunk-9-1.png" width="100%" /></p>
<p>Main effects plots give important insights in to the experiement outcomes and this even before any statistical analysis with a linear model and anova. From these three plots the Quality Analyst already takes the following observations for her report:</p>
<ul>
<li>bias increases in negative direction as dry matter content increases</li>
<li>bias increases in positive direction as particle size increases</li>
<li>bias is not influence by line speed</li>
</ul>
</div>
<div id="interaction_plot" class="section level3">
<h3>Interaction plots (custom)</h3>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="DOE.html#cb201-1" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_particle_size_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb201-2"><a href="DOE.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">particle_size =</span> <span class="fu">as_factor</span>(particle_size)) <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="DOE.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drymatter_TGT, particle_size) <span class="sc">%&gt;%</span></span>
<span id="cb201-4"><a href="DOE.html#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">drymatter_bias_mean =</span> <span class="fu">mean</span>(bias), <span class="at">drymatter_bias_sd =</span> <span class="fu">sd</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb201-5"><a href="DOE.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drymatter_TGT, <span class="at">y =</span> drymatter_bias_mean, <span class="at">color =</span> particle_size, <span class="at">linetype =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb201-6"><a href="DOE.html#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb201-7"><a href="DOE.html#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size, <span class="at">linetype =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb201-8"><a href="DOE.html#cb201-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb201-9"><a href="DOE.html#cb201-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb201-10"><a href="DOE.html#cb201-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> drymatter_bias_mean <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb201-11"><a href="DOE.html#cb201-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> drymatter_bias_mean <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb201-12"><a href="DOE.html#cb201-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb201-13"><a href="DOE.html#cb201-13" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb201-14"><a href="DOE.html#cb201-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.7</span>, <span class="at">name =</span> <span class="st">&quot;Particle size&quot;</span>) <span class="sc">+</span></span>
<span id="cb201-15"><a href="DOE.html#cb201-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb201-16"><a href="DOE.html#cb201-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">21</span>),</span>
<span id="cb201-17"><a href="DOE.html#cb201-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb201-18"><a href="DOE.html#cb201-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 2xSD&quot;</span>, </span>
<span id="cb201-19"><a href="DOE.html#cb201-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb201-20"><a href="DOE.html#cb201-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb201-21"><a href="DOE.html#cb201-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb201-22"><a href="DOE.html#cb201-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Juice bottling problem&quot;</span>,</span>
<span id="cb201-23"><a href="DOE.html#cb201-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Interaction plots&quot;</span>,</span>
<span id="cb201-24"><a href="DOE.html#cb201-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Drymatter target&quot;</span>,</span>
<span id="cb201-25"><a href="DOE.html#cb201-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias deviation [g]&quot;</span></span>
<span id="cb201-26"><a href="DOE.html#cb201-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb201-27"><a href="DOE.html#cb201-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span></code></pre></div>
<p>Now to look deeper and sheâs preparing interaction plots. She wants to understand if factors combine in unexpected ways at certain levels. In designs like these with 3 factors we have 3 possible interactions (A-B, A-C, B-C) corresponding the the possible combination between them. It is important to keep in mind that at least two replicates by run are needed to be able determine the sum of squares due to error, this if all possible interactions are to be included in the model. As the plan is a full factorial plan and there are more than 2 replicates, all factor combinations are resolved and can be assessed for their significance. The interaction plots show precisely such combinations, two at a time against the output. The first one Dry matter target - Particle Size being ready she moves to the next two: Dry matter target - Speed and Speed - Particle Size.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="DOE.html#cb202-1" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_speed_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb202-2"><a href="DOE.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speed =</span> <span class="fu">as_factor</span>(speed)) <span class="sc">%&gt;%</span></span>
<span id="cb202-3"><a href="DOE.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drymatter_TGT, speed) <span class="sc">%&gt;%</span></span>
<span id="cb202-4"><a href="DOE.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">drymatter_bias_mean =</span> <span class="fu">mean</span>(bias), <span class="at">drymatter_bias_sd =</span> <span class="fu">sd</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb202-5"><a href="DOE.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drymatter_TGT, <span class="at">y =</span> drymatter_bias_mean, <span class="at">color =</span> speed)) <span class="sc">+</span></span>
<span id="cb202-6"><a href="DOE.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> speed), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb202-7"><a href="DOE.html#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> speed, <span class="at">linetype =</span> speed)) <span class="sc">+</span></span>
<span id="cb202-8"><a href="DOE.html#cb202-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>( <span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb202-9"><a href="DOE.html#cb202-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.7</span>, <span class="at">name =</span> <span class="st">&quot;Speed&quot;</span>) <span class="sc">+</span></span>
<span id="cb202-10"><a href="DOE.html#cb202-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb202-11"><a href="DOE.html#cb202-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> drymatter_bias_mean <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb202-12"><a href="DOE.html#cb202-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> drymatter_bias_mean <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb202-13"><a href="DOE.html#cb202-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb202-14"><a href="DOE.html#cb202-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb202-15"><a href="DOE.html#cb202-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb202-16"><a href="DOE.html#cb202-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">21</span>),</span>
<span id="cb202-17"><a href="DOE.html#cb202-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb202-18"><a href="DOE.html#cb202-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 2xSD&quot;</span>, </span>
<span id="cb202-19"><a href="DOE.html#cb202-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb202-20"><a href="DOE.html#cb202-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb202-21"><a href="DOE.html#cb202-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb202-22"><a href="DOE.html#cb202-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Dry matter target&quot;</span>,</span>
<span id="cb202-23"><a href="DOE.html#cb202-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias deviation [g]&quot;</span></span>
<span id="cb202-24"><a href="DOE.html#cb202-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb202-25"><a href="DOE.html#cb202-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb202-26"><a href="DOE.html#cb202-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-27"><a href="DOE.html#cb202-27" aria-hidden="true" tabindex="-1"></a>speed_particle_size_plot <span class="ot">&lt;-</span> juice_drymatter <span class="sc">%&gt;%</span>  </span>
<span id="cb202-28"><a href="DOE.html#cb202-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">particle_size =</span> <span class="fu">as_factor</span>(particle_size)) <span class="sc">%&gt;%</span></span>
<span id="cb202-29"><a href="DOE.html#cb202-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(speed, particle_size) <span class="sc">%&gt;%</span></span>
<span id="cb202-30"><a href="DOE.html#cb202-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">drymatter_bias_mean =</span> <span class="fu">mean</span>(bias), <span class="at">drymatter_bias_sd =</span> <span class="fu">sd</span>(bias)) <span class="sc">%&gt;%</span></span>
<span id="cb202-31"><a href="DOE.html#cb202-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> drymatter_bias_mean, <span class="at">color =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb202-32"><a href="DOE.html#cb202-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb202-33"><a href="DOE.html#cb202-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> particle_size, <span class="at">linetype =</span> particle_size)) <span class="sc">+</span></span>
<span id="cb202-34"><a href="DOE.html#cb202-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="at">guide=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb202-35"><a href="DOE.html#cb202-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;C&quot;</span>, <span class="at">begin =</span> <span class="fl">0.3</span>, <span class="at">end =</span> <span class="fl">0.7</span>, <span class="at">name =</span> <span class="st">&quot;Particle size&quot;</span>) <span class="sc">+</span></span>
<span id="cb202-36"><a href="DOE.html#cb202-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(</span>
<span id="cb202-37"><a href="DOE.html#cb202-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> drymatter_bias_mean <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb202-38"><a href="DOE.html#cb202-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> drymatter_bias_mean <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> drymatter_bias_sd,</span>
<span id="cb202-39"><a href="DOE.html#cb202-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb202-40"><a href="DOE.html#cb202-40" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb202-41"><a href="DOE.html#cb202-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb202-42"><a href="DOE.html#cb202-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">26</span>),</span>
<span id="cb202-43"><a href="DOE.html#cb202-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>), <span class="at">expand =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb202-44"><a href="DOE.html#cb202-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;Error bars are +/- 2xSD&quot;</span>, </span>
<span id="cb202-45"><a href="DOE.html#cb202-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb202-46"><a href="DOE.html#cb202-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb202-47"><a href="DOE.html#cb202-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb202-48"><a href="DOE.html#cb202-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Speed&quot;</span>,</span>
<span id="cb202-49"><a href="DOE.html#cb202-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Average bias deviation [g]&quot;</span></span>
<span id="cb202-50"><a href="DOE.html#cb202-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb202-51"><a href="DOE.html#cb202-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb202-52"><a href="DOE.html#cb202-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-53"><a href="DOE.html#cb202-53" aria-hidden="true" tabindex="-1"></a>drymatter_TGT_particle_size_plot <span class="sc">+</span> drymatter_TGT_speed_plot <span class="sc">+</span> speed_particle_size_plot</span></code></pre></div>
<p><img src="8_generalDOEs_files/figure-html/unnamed-chunk-11-1.png" width="100%" /></p>
<p>The approach here goes much beyond the interaction.plot function from the <code>{stats}</code> package introduced before and the code to obtain this plots is significantly longer. She has chosen to develop here the plots with <code>{ggplot2}</code> because she wanted to have direct access to all the minor details in the contruction of the plot such as the colors by line, a custom error bars calculation, very specific locations for the legends. She ends up concluding that there is no interaction between any of the different factors as all lines do not intercept, are mostly parallel and error bars cover each other.</p>
</div>
<div id="formula_expansion" class="section level3">
<h3>Formula expansion</h3>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="DOE.html#cb203-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> Y <span class="sc">~</span> A <span class="sc">*</span> B <span class="sc">*</span> C</span>
<span id="cb203-2"><a href="DOE.html#cb203-2" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> Y <span class="sc">~</span> A <span class="sc">*</span> B <span class="sc">+</span> C</span></code></pre></div>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="DOE.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_formula</span>(f1)</span></code></pre></div>
<pre><code>[1] &quot;A&quot;     &quot;B&quot;     &quot;C&quot;     &quot;A:B&quot;   &quot;A:C&quot;   &quot;B:C&quot;   &quot;A:B:C&quot;</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="DOE.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_formula</span>(f2)</span></code></pre></div>
<pre><code>[1] &quot;A&quot;   &quot;B&quot;   &quot;C&quot;   &quot;A:B&quot;</code></pre>
<p>The short code chunk before shows two formula expansion examples, the first one corresponding to our Juice DOE: in a design with factors coded A, B and C the sources of variation for the Anova table for three-factor fixed effects model are: A, B, C, AB, AC, BC, ABC. The second case corresponds to a situation where interactions with C would be discarded. Understanding these syntax details is very important because as more and more factors are added to models, the number of trials grows to unrealistic quantities. In such situations a preliminary work consisting in the selection of specific interactions enables the creation a fractional design. For now the juice doe is still small with 108 trials so she can move ahead assessing the effect significance of the different factors using the anova.</p>
</div>
<div id="anova_three" class="section level3">
<h3>Anova with 3rd level interactions</h3>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="DOE.html#cb208-1" aria-hidden="true" tabindex="-1"></a>juice_drymatter_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb208-2"><a href="DOE.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  bias <span class="sc">~</span> drymatter_TGT <span class="sc">*</span> speed <span class="sc">*</span> particle_size,</span>
<span id="cb208-3"><a href="DOE.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> juice_drymatter)</span>
<span id="cb208-4"><a href="DOE.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(juice_drymatter_aov)</span></code></pre></div>
<pre><code>                                   Df Sum Sq Mean Sq F value Pr(&gt;F)    
drymatter_TGT                       1  1.315   1.315  486.06 &lt;2e-16 ***
speed                               1  0.000   0.000    0.00   0.99    
particle_size                       1  0.624   0.624  230.70 &lt;2e-16 ***
drymatter_TGT:speed                 1  0.001   0.001    0.27   0.60    
drymatter_TGT:particle_size         1  0.003   0.003    1.04   0.31    
speed:particle_size                 1  0.003   0.003    1.19   0.28    
drymatter_TGT:speed:particle_size   1  0.004   0.004    1.44   0.23    
Residuals                         100  0.271   0.003                   
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Here she simplified things by inputing the formula directly in the aov function without passing by the <code>formula()</code> or <code>lm()</code> functions. The previous observations done on the plots are fully confirmed and now supported with statistical evidence: <code>drymatter target</code> and <code>particle_size</code> significantly affect the bias (p &lt; 0.05); <code>speed</code> has no effect; none of the interactions is significative. This first round of assessment was very clear and successful and she can make bold proposals to the Quality Manager now to look deeper into the links between drymatter target and particle size in that bias. Certainly passing by a discussion again with the product team and a final DOE with more levels to identify or select an optimal operating zone for the measurement method.</p>

</div>
</div>
<div id="two-level-designs" class="section level2">
<h2>Two level designs</h2>
<p>We may be armed with powerful tools to design and analyze experiments and even have strong knowledge in the topic weâre studying but real life in a laboratory or in a factory has many constraints and a DOE is always the reflection of them. The calculation of the number of trials presented in the previous case shows a very quick explosion of the volume of work and material consumption. Another aspect is that as knowledge progresses and findings are accumulated certain variables which present little influence in the outputs start to be discarded. This is a consequence of the sparcity of effects principle. Data and models constructed in several preliminary DOEs can be consolidated under certain conditions. So the design of a new DOE should take into account the design of the previous one and this regarding not only the variables but even the levels themselves. With all these practical considerations in mind it is possible and common to start with very large screening experiments with for instance 10 inputs and 10 outputs and end up with a narrow optimization experiment with 2 factors with 4 levels to select a fine operating window.</p>
<p>A way to make screening experiments realistic is to limit the number of levels of the factors, the minimum being 2 to have a complete factorial design. Following the notation also presented in the previous case study these designs are called <span class="math inline">\(2^{k}\)</span> designs. Application of linear models and interpretation of anova is subject to the same assumptions as general cases discussed, these being the factors are fixed, the designs are completely randomized, the normality assumptions are satisfied. In particular as there are only 2 levels it is assumed that the response is approximately linear between the factor levels.</p>
<p>In the next case studies we continue follow the same general steps:</p>
<ul>
<li>Identify factors</li>
<li>Estimate factor effects</li>
<li>Form initial full model</li>
<li>Check model including residuals</li>
<li>Assess significance of effects including factor interactions</li>
<li>Interpret results</li>
<li>Refine model by removing the non significant effects</li>
<li>Re-check model</li>
<li>Draw final conclusions</li>
</ul>
<p>In this first Case Study dedicated to <span class="math inline">\(2^k\)</span> designs weâre going to start by explore the contrasts settings in the linear model functions as the coding of factors becomes a key tool in the linear model construction in R and in the way to use the forecasting tools.</p>
<div class="marginnote">
<p><b class="highlight">Case study: PET clothing improvement plan</b></p>
<p>Consumer demand for recycled materials increases requiring clothing manufacturers to develop new products made with innovative and often more expensive raw materials while keeping historical quality levels.</p>
<p><img src="img/PET_lamination_bw.jpg" width="100%" /></p>
</div>
<div id="factorial-design-2-levels" class="section level3">
<h3>Factorial design 2 levels</h3>
<p>A materials engineer working in the <b class="highlight">winter sports clothing industry</b> has been working in the development of a recyclable PET. Previous tests have shown promising results on tensile strength, one of the main characteristics required from the raw material. The trade offs between performance, costs and recyclability are not obvious to obtain due to lack of experience and specific know-how. Several one at a time comparisions between supplier deliveries have been done but now she wanted to go further and has established together with the raw material supplier factorial design with two factors presented in the output of the next R chunk. Most of the time process recipes at raw material producer need to are kept confidential for competitive reasons. This makes she only had access to a generic description of the factor levels:</p>
<p>A: bi-axial orientation in production (yes/no)<br />
B: nucleating agent level (high/low)</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="DOE.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoE.base)</span></code></pre></div>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="DOE.html#cb211-1" aria-hidden="true" tabindex="-1"></a>pet_doe <span class="ot">&lt;-</span> <span class="fu">fac.design</span>(</span>
<span id="cb211-2"><a href="DOE.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb211-3"><a href="DOE.html#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">factor.names =</span> <span class="fu">list</span>(</span>
<span id="cb211-4"><a href="DOE.html#cb211-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;+&quot;</span>), </span>
<span id="cb211-5"><a href="DOE.html#cb211-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">B =</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;+&quot;</span>),</span>
<span id="cb211-6"><a href="DOE.html#cb211-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">replicate =</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>)</span>
<span id="cb211-7"><a href="DOE.html#cb211-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb211-8"><a href="DOE.html#cb211-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>After a quick check the plan is confirmed to be ok, she sees all combinations of factors at with 3 replicates. Sheâs not so confortable with such a small number of replicates but as there is no protyping tool in the producers plant they used directly an industrial laminator. Fitting trials in production time is most of the time a big challenge not to mention the cost and the waste in materials. She shares the plan in a meeting and a few weeks later receives the numbers from the producers laboratory in a short e-mail with a list of numbers with no units 64.4, 82.8, 41.4â¦</p>
<p>Getting back to her contact at the producer she gets a confirmation these are the PET tensile strength values for each of the trials in the same order as the trial plan was provided. She regrets not having given a number to each trial and asked to have a clear reference of each measured value. She again compromises and colates the values to the original tibble in R:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="DOE.html#cb212-1" aria-hidden="true" tabindex="-1"></a>tensile_strength <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb212-2"><a href="DOE.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">64.4</span>,<span class="fl">82.8</span>,<span class="fl">41.4</span>,<span class="fl">71.3</span>,<span class="fl">57.5</span>,<span class="fl">73.6</span>,<span class="fl">43.7</span>,<span class="fl">69.0</span>,<span class="fl">62.1</span>,<span class="fl">73.6</span>,<span class="fl">52.9</span>,<span class="fl">66.7</span></span>
<span id="cb212-3"><a href="DOE.html#cb212-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb212-4"><a href="DOE.html#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="DOE.html#cb212-5" aria-hidden="true" tabindex="-1"></a>pet_doe <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb212-6"><a href="DOE.html#cb212-6" aria-hidden="true" tabindex="-1"></a>  pet_doe,</span>
<span id="cb212-7"><a href="DOE.html#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;tensile_strength&quot;</span> <span class="ot">=</span> tensile_strength,</span>
<span id="cb212-8"><a href="DOE.html#cb212-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-9"><a href="DOE.html#cb212-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-10"><a href="DOE.html#cb212-10" aria-hidden="true" tabindex="-1"></a>pet_doe <span class="sc">%&gt;%</span></span>
<span id="cb212-11"><a href="DOE.html#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb212-12"><a href="DOE.html#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">A</th>
<th align="left">B</th>
<th align="left">replicate</th>
<th align="right">tensile_strength</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">-</td>
<td align="left">-</td>
<td align="left">I</td>
<td align="right">64.4</td>
</tr>
<tr class="even">
<td align="left">+</td>
<td align="left">-</td>
<td align="left">I</td>
<td align="right">82.8</td>
</tr>
<tr class="odd">
<td align="left">-</td>
<td align="left">+</td>
<td align="left">I</td>
<td align="right">41.4</td>
</tr>
<tr class="even">
<td align="left">+</td>
<td align="left">+</td>
<td align="left">I</td>
<td align="right">71.3</td>
</tr>
<tr class="odd">
<td align="left">-</td>
<td align="left">-</td>
<td align="left">II</td>
<td align="right">57.5</td>
</tr>
<tr class="even">
<td align="left">+</td>
<td align="left">-</td>
<td align="left">II</td>
<td align="right">73.6</td>
</tr>
</tbody>
</table>
<p>Now sheâs ready to move ahead by coding properly the factors and input them in the linear model. Sheâs not so used to DOEs with coded factors so she tries three different approaches: a first one with the factors labeled plus/minus, a second one with the factors labeled +1/-1 and a third one with the factors as +1/-1 but numeric. She ends up choosing this last option which seems more natural for forecasting.</p>
</div>
<div id="coding_levels" class="section level3">
<h3>Coding levels</h3>
<div id="factors-as--" class="section level4">
<h4>Factors as +/-</h4>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="DOE.html#cb213-1" aria-hidden="true" tabindex="-1"></a>pet_plusminus <span class="ot">&lt;-</span> pet_doe</span>
<span id="cb213-2"><a href="DOE.html#cb213-2" aria-hidden="true" tabindex="-1"></a>pet_plusminus<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_plusminus<span class="sc">$</span>A, <span class="at">ref =</span> <span class="st">&quot;+&quot;</span>)</span>
<span id="cb213-3"><a href="DOE.html#cb213-3" aria-hidden="true" tabindex="-1"></a>pet_plusminus<span class="sc">$</span>B <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_plusminus<span class="sc">$</span>B, <span class="at">ref =</span> <span class="st">&quot;+&quot;</span>)</span></code></pre></div>
<p>For the first model the materials engineer made a copy of the original dataset and left the input variables as they were generated which is as factors and with the labels âplusâ and âminus.â After some playing with data she found necessary to put the âplusâ as the reference otherwise she gets inverted signs in the lm output.</p>
<p>Another detail she needed to take care was the setup of the contrasts. As the design is ortogonal and she wanted the contrasts to add up to zero she had to precise by assigning <code>contr.sum</code> to the factor. First she checked the original definition of the contrasts:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="DOE.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_plusminus<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>  -
+ 0
- 1</code></pre>
<p>The original/default setting is <code>contr.treatm</code> as seen in the corresponding unit and she changed this with:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="DOE.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_plusminus<span class="sc">$</span>A) <span class="ot">&lt;-</span> <span class="st">&quot;contr.sum&quot;</span></span>
<span id="cb216-2"><a href="DOE.html#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_plusminus<span class="sc">$</span>B) <span class="ot">&lt;-</span> <span class="st">&quot;contr.sum&quot;</span></span>
<span id="cb216-3"><a href="DOE.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_plusminus<span class="sc">$</span>A)</span></code></pre></div>
<pre><code>  [,1]
+    1
-   -1</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="DOE.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(pet_plusminus<span class="sc">$</span>B)</span></code></pre></div>
<pre><code>  [,1]
+    1
-   -1</code></pre>
<p>Having confirmed that the sum of the contrast is zero she establishes the linear model and makes a prediction to check the output:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="DOE.html#cb220-1" aria-hidden="true" tabindex="-1"></a>pet_plusminus_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb220-2"><a href="DOE.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> tensile_strength <span class="sc">~</span> A <span class="sc">*</span> B, </span>
<span id="cb220-3"><a href="DOE.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_plusminus</span>
<span id="cb220-4"><a href="DOE.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-5"><a href="DOE.html#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_plusminus_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = tensile_strength ~ A * B, data = pet_plusminus)

Residuals:
   Min     1Q Median     3Q    Max 
 -4.60  -3.07  -1.15   2.49   6.90 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    63.25       1.31   48.14  3.8e-11 ***
A1              9.58       1.31    7.29  8.4e-05 ***
B1             -5.75       1.31   -4.38   0.0024 ** 
A1:B1           1.92       1.31    1.46   0.1828    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 4.55 on 8 degrees of freedom
Multiple R-squared:  0.903,	Adjusted R-squared:  0.867 
F-statistic: 24.8 on 3 and 8 DF,  p-value: 0.000209</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="DOE.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(pet_plusminus_lm, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="st">&quot;+&quot;</span>, <span class="at">B =</span> <span class="st">&quot;+&quot;</span>))</span></code></pre></div>
<pre><code> 1 
69 </code></pre>
</div>
<div id="factors-as---1" class="section level4">
<h4>Factors as +/- 1</h4>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="DOE.html#cb224-1" aria-hidden="true" tabindex="-1"></a>coded <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">ifelse</span>(x <span class="sc">==</span> x[<span class="dv">1</span>], <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) }</span>
<span id="cb224-2"><a href="DOE.html#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3"><a href="DOE.html#cb224-3" aria-hidden="true" tabindex="-1"></a>pet_doe <span class="ot">&lt;-</span> pet_doe <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B))</span>
<span id="cb224-4"><a href="DOE.html#cb224-4" aria-hidden="true" tabindex="-1"></a>pet_plusminus1 <span class="ot">&lt;-</span> pet_doe <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(cA, cB), as_factor))</span>
<span id="cb224-5"><a href="DOE.html#cb224-5" aria-hidden="true" tabindex="-1"></a>pet_plusminus1<span class="sc">$</span>cA <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_plusminus1<span class="sc">$</span>cA, <span class="at">ref =</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb224-6"><a href="DOE.html#cb224-6" aria-hidden="true" tabindex="-1"></a>pet_plusminus1<span class="sc">$</span>cB <span class="ot">&lt;-</span> <span class="fu">relevel</span>(pet_plusminus1<span class="sc">$</span>cB, <span class="at">ref =</span> <span class="st">&quot;1&quot;</span>)</span>
<span id="cb224-7"><a href="DOE.html#cb224-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-8"><a href="DOE.html#cb224-8" aria-hidden="true" tabindex="-1"></a>pet_plusminus1 <span class="sc">%&gt;%</span></span>
<span id="cb224-9"><a href="DOE.html#cb224-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb224-10"><a href="DOE.html#cb224-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">A</th>
<th align="center">B</th>
<th align="center">replicate</th>
<th align="center">tensile_strength</th>
<th align="center">cA</th>
<th align="center">cB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">-</td>
<td align="center">-</td>
<td align="center">I</td>
<td align="center">64.4</td>
<td align="center">-1</td>
<td align="center">-1</td>
</tr>
<tr class="even">
<td align="center">+</td>
<td align="center">-</td>
<td align="center">I</td>
<td align="center">82.8</td>
<td align="center">1</td>
<td align="center">-1</td>
</tr>
<tr class="odd">
<td align="center">-</td>
<td align="center">+</td>
<td align="center">I</td>
<td align="center">41.4</td>
<td align="center">-1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>The second approach she tries is to convert the levels to +1/-1 still leaving them coded as factors. This notation is easier for her as it corresponds to a common way she sees in the Yates tables. Again she had to relevel the factors to get the max as reference in order to get the same coefficients on the linear model. Regarding the contrasts she goes for the simpler and more direct approach now by defining them directly in the lm() function.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="DOE.html#cb225-1" aria-hidden="true" tabindex="-1"></a>pet_plusminus1_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb225-2"><a href="DOE.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> tensile_strength <span class="sc">~</span> cA <span class="sc">*</span> cB, </span>
<span id="cb225-3"><a href="DOE.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_plusminus1,</span>
<span id="cb225-4"><a href="DOE.html#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrasts =</span> <span class="fu">list</span>(<span class="at">cA =</span> <span class="st">&quot;contr.sum&quot;</span>, <span class="at">cB =</span> <span class="st">&quot;contr.sum&quot;</span>)</span>
<span id="cb225-5"><a href="DOE.html#cb225-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb225-6"><a href="DOE.html#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_plusminus1_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = tensile_strength ~ cA * cB, data = pet_plusminus1, 
    contrasts = list(cA = &quot;contr.sum&quot;, cB = &quot;contr.sum&quot;))

Residuals:
   Min     1Q Median     3Q    Max 
 -4.60  -3.07  -1.15   2.49   6.90 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    63.25       1.31   48.14  3.8e-11 ***
cA1             9.58       1.31    7.29  8.4e-05 ***
cB1            -5.75       1.31   -4.38   0.0024 ** 
cA1:cB1         1.92       1.31    1.46   0.1828    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 4.55 on 8 degrees of freedom
Multiple R-squared:  0.903,	Adjusted R-squared:  0.867 
F-statistic: 24.8 on 3 and 8 DF,  p-value: 0.000209</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="DOE.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(pet_plusminus1_lm, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">cA =</span> <span class="st">&quot;1&quot;</span>, <span class="at">cB =</span> <span class="st">&quot;1&quot;</span>))</span></code></pre></div>
<pre><code> 1 
69 </code></pre>
<p>Note that a coefficient in a regression equation is the change in the response when the corresponding variable changes by +1. Special attention to the + and - needs to be taken with the R output. As A or B changes from its high level to its low level, the coded variable changes by 1 â (â1) = +2, so the change in the response from the min to the max is twice the regression coefficient.</p>
<p>So the effects and interaction(s) from their minumum to their maximum correspond to twice the values in the âEstimateâ column. These regression coefficients are often called effects and interactions, even though they differ from the definitions used in the designs themeselves.</p>
</div>
<div id="factors-as---1-numeric" class="section level4">
<h4>Factors as +/- 1 numeric</h4>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="DOE.html#cb229-1" aria-hidden="true" tabindex="-1"></a>pet_num <span class="ot">&lt;-</span> pet_doe <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B))</span>
<span id="cb229-2"><a href="DOE.html#cb229-2" aria-hidden="true" tabindex="-1"></a>pet_num_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb229-3"><a href="DOE.html#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> tensile_strength <span class="sc">~</span> cA <span class="sc">*</span> cB, </span>
<span id="cb229-4"><a href="DOE.html#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pet_num</span>
<span id="cb229-5"><a href="DOE.html#cb229-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb229-6"><a href="DOE.html#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pet_num_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = tensile_strength ~ cA * cB, data = pet_num)

Residuals:
   Min     1Q Median     3Q    Max 
 -4.60  -3.07  -1.15   2.49   6.90 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    63.25       1.31   48.14  3.8e-11 ***
cA              9.58       1.31    7.29  8.4e-05 ***
cB             -5.75       1.31   -4.38   0.0024 ** 
cA:cB           1.92       1.31    1.46   0.1828    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 4.55 on 8 degrees of freedom
Multiple R-squared:  0.903,	Adjusted R-squared:  0.867 
F-statistic: 24.8 on 3 and 8 DF,  p-value: 0.000209</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="DOE.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(pet_num_lm, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">cA =</span> <span class="dv">1</span>, <span class="at">cB =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code> 1 
69 </code></pre>
<p>Finaly the materials engineer coded the levels with +1/-1 but left the variables with type numeric. In this case she did not define any contrasts. Looking into the lm and prediction she confirms having obtained exactly the same outputs.</p>
<p>As the inputs are coded as numeric this behaves just like the predictions with the first linear model studied in our book. Note that we feed the predictions function with numeric values. This is very intuitive as it corresponds to the original units of the experiments (also called natural or engineering units). On the other hand coding the design variables provides another advange: generally, the engineering units are not directly comparable while coded variables are very effective for determining the relative size of factor effects.</p>
<p>Coding the design factors has the benefit of enabling a direct comparison of the effect sizes and we can see that these three ways of coding the variable levels lead to equivalent results both in lm and prediction. Her preference goes to using numeric values as it is more intuitive and allows for easier prediction between the fixed levels.</p>
<p>In order to better visualize the coding of factors she established a simple regression plot of the data. Note that she had to extract the data from the S3 doe object, which weâve done with using unclass() and then as_tibble()</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="DOE.html#cb233-1" aria-hidden="true" tabindex="-1"></a>pet_num <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="DOE.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unclass</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb233-3"><a href="DOE.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb233-4"><a href="DOE.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B)) <span class="sc">%&gt;%</span></span>
<span id="cb233-5"><a href="DOE.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb233-6"><a href="DOE.html#cb233-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;cA&quot;</span>, <span class="st">&quot;cB&quot;</span>),</span>
<span id="cb233-7"><a href="DOE.html#cb233-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb233-8"><a href="DOE.html#cb233-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb233-9"><a href="DOE.html#cb233-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb233-10"><a href="DOE.html#cb233-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength)) <span class="sc">+</span></span>
<span id="cb233-11"><a href="DOE.html#cb233-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength), </span>
<span id="cb233-12"><a href="DOE.html#cb233-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb233-13"><a href="DOE.html#cb233-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb233-14"><a href="DOE.html#cb233-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb233-15"><a href="DOE.html#cb233-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(variable)) <span class="sc">+</span></span>
<span id="cb233-16"><a href="DOE.html#cb233-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb233-17"><a href="DOE.html#cb233-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;PET tensile strenght improvement DOE&quot;</span>,</span>
<span id="cb233-18"><a href="DOE.html#cb233-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Tensile strenght [MPa]&quot;</span>,</span>
<span id="cb233-19"><a href="DOE.html#cb233-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Coded levels&quot;</span></span>
<span id="cb233-20"><a href="DOE.html#cb233-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-12-1.png" width="100%" /></p>
<p>From the <code>lm()</code> summary she remembers that the intercept passes at 27.5 and she replorts now to putting the B factor at its maximum:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="DOE.html#cb234-1" aria-hidden="true" tabindex="-1"></a>pet_num <span class="sc">%&gt;%</span> </span>
<span id="cb234-2"><a href="DOE.html#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unclass</span>() <span class="sc">%&gt;%</span></span>
<span id="cb234-3"><a href="DOE.html#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb234-4"><a href="DOE.html#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cA =</span> <span class="fu">coded</span>(A), <span class="at">cB =</span> <span class="fu">coded</span>(B)) <span class="sc">%&gt;%</span></span>
<span id="cb234-5"><a href="DOE.html#cb234-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cB <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-6"><a href="DOE.html#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb234-7"><a href="DOE.html#cb234-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;cA&quot;</span>, <span class="st">&quot;cB&quot;</span>),</span>
<span id="cb234-8"><a href="DOE.html#cb234-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb234-9"><a href="DOE.html#cb234-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb234-10"><a href="DOE.html#cb234-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb234-11"><a href="DOE.html#cb234-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength)) <span class="sc">+</span></span>
<span id="cb234-12"><a href="DOE.html#cb234-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> tensile_strength), </span>
<span id="cb234-13"><a href="DOE.html#cb234-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb234-14"><a href="DOE.html#cb234-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb234-15"><a href="DOE.html#cb234-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb234-16"><a href="DOE.html#cb234-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(variable)) <span class="sc">+</span></span>
<span id="cb234-17"><a href="DOE.html#cb234-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb234-18"><a href="DOE.html#cb234-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;PET tensile strenght improvement DOE&quot;</span>,</span>
<span id="cb234-19"><a href="DOE.html#cb234-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Tensile strenght [MPa]&quot;</span>,</span>
<span id="cb234-20"><a href="DOE.html#cb234-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Coded levels&quot;</span></span>
<span id="cb234-21"><a href="DOE.html#cb234-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-13-1.png" width="100%" /></p>
<p>The plot confirms that the output of the prediction is 69 corresponding to the max level of A when B is also at the max. Mathematically she confirms this result by multiplying all the linear regression coefficients by the levels of the factors as : <span class="math inline">\(63.250 + 9.583 \times (+1) - 5.750 \times (+1) + 1.917 = 69\)</span></p>
</div>
</div>
<div id="plotMeans" class="section level3">
<h3>Interaction plots with SE</h3>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="DOE.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcmdrMisc)</span></code></pre></div>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="DOE.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">bty =</span> <span class="st">&quot;l&quot;</span>)</span>
<span id="cb236-2"><a href="DOE.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMeans</span>(<span class="at">response =</span> pet_doe<span class="sc">$</span>tensile_strength,</span>
<span id="cb236-3"><a href="DOE.html#cb236-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">factor1 =</span> pet_doe<span class="sc">$</span>A,</span>
<span id="cb236-4"><a href="DOE.html#cb236-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">&quot;A: bi-axial orientation in production (yes/no)&quot;</span>,</span>
<span id="cb236-5"><a href="DOE.html#cb236-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">factor2 =</span> pet_doe<span class="sc">$</span>B,</span>
<span id="cb236-6"><a href="DOE.html#cb236-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.lab =</span> <span class="st">&quot;B: nucleating agent (high/low)&quot;</span>,</span>
<span id="cb236-7"><a href="DOE.html#cb236-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">&quot;Tensile Strenght [Mpa]&quot;</span>,</span>
<span id="cb236-8"><a href="DOE.html#cb236-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">error.bars =</span> <span class="st">&quot;se&quot;</span>,</span>
<span id="cb236-9"><a href="DOE.html#cb236-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">4</span>],</span>
<span id="cb236-10"><a href="DOE.html#cb236-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.pos =</span> <span class="st">&quot;bottomright&quot;</span>,</span>
<span id="cb236-11"><a href="DOE.html#cb236-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">&quot;The PET clothing improvement plan&quot;</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-15-1.png" width="100%" /></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="DOE.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>() </span></code></pre></div>
<pre><code>null device 
          1 </code></pre>
<p>Now she want to get quickly an interaction plot but including error bars. Unfortunately the base R <code>interaction.plot()</code> doesnât provide it and the <code>ggplot2()</code> made it to long. With a quick check on Stackoverflow she discovered this simple approach with the function <code>plotMeans()</code> from the package {RcmdrMisc} and she gets the plot dine with standard error as argument for the <code>error.bars</code> argument.</p>
<p>As expected she confirms that both treatments provide an visible effect on Tensile strenght and that there is no interaction between them.</p>
</div>
<div id="adj_Rsquare" class="section level3">
<h3>Adjusted R-squared</h3>
<div class="marginnote">
<p><b class="highlight">Case study: lithium-ion battery charging time</b></p>
<p>The global transition to full electrical car is well underway and thereâs a global trend in legislating towards the end of fossil fuel cars. The challenge of authonomy has been brought to acceptable levels with the extensive deployment of electric charging stations but engineering teams still face complex problems such as the charging time. At a pioneering manufacturer another DOE is underway to get it optimized.</p>
<p><img src="img/electrical_car_bw.png" width="100%" /></p>
</div>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="DOE.html#cb239-1" aria-hidden="true" tabindex="-1"></a>battery_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb239-2"><a href="DOE.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">*</span> B <span class="sc">*</span> C, </span>
<span id="cb239-3"><a href="DOE.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging</span>
<span id="cb239-4"><a href="DOE.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb239-5"><a href="DOE.html#cb239-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A * B * C, data = battery_charging)

Residuals:
   Min     1Q Median     3Q    Max 
-2.595 -1.076 -0.450  0.965  4.155 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    6.787      0.325   20.89   &lt;2e-16 ***
A              0.940      0.325    2.89   0.0080 ** 
B             -0.182      0.325   -0.56   0.5813    
C              1.040      0.325    3.20   0.0038 ** 
A:B            0.163      0.325    0.50   0.6208    
A:C           -0.809      0.325   -2.49   0.0201 *  
B:C           -0.349      0.325   -1.07   0.2932    
A:B:C          0.408      0.325    1.26   0.2214    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.84 on 24 degrees of freedom
Multiple R-squared:  0.54,	Adjusted R-squared:  0.405 
F-statistic: 4.02 on 7 and 24 DF,  p-value: 0.00481</code></pre>
<p>The R-squared was introduced in the linear models unit as a way to assess the quality of the model fit. A potential problem with this statistic is that it always increases as factors are added to the model, even if these factors are not significant. This can be overcomed by using the adjusted R-squared which is obtained by dividing the Sums of Squares by the degrees of freedom, and is adjusted for the size of the model, that is the number of factors. Both indicators are part of the <code>summary()</code> output of the <code>lm()</code> function applied on the <code>charging_time</code> dataset as we could just see in the previous chunk. Below weâre comparing both indicators.</p>
<p>A consulting company specialized in data science is supporting a global manufacturer of electrical car batteries to further optimize a <b class="highlight">lithium-ion battery charging time</b>. The latest DOE consisted of 3 input factors as follows:</p>
<p>A - temperature (-1 = -10Â°C, +1 = 40Â°C)
B - voltage (-1 = 120V, +1 = 220V)
C - age (-1 = 10â000 cycles, +1 = 0 cycles)<br />
Z - charging time [h]</p>
<p>The model can now be passed to the <code>aov()</code> function for an assessment of the significance of the different factors:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="DOE.html#cb241-1" aria-hidden="true" tabindex="-1"></a>battery_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(battery_lm)</span>
<span id="cb241-2"><a href="DOE.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_aov)</span></code></pre></div>
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)   
A            1   28.3    28.3    8.37 0.0080 **
B            1    1.1     1.1    0.31 0.5813   
C            1   34.6    34.6   10.26 0.0038 **
A:B          1    0.8     0.8    0.25 0.6208   
A:C          1   20.9    20.9    6.20 0.0201 * 
B:C          1    3.9     3.9    1.15 0.2932   
A:B:C        1    5.3     5.3    1.58 0.2214   
Residuals   24   81.0     3.4                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The main effects of temperature and age are significant as is their interaction. Voltage has no influence on the output. An updated model is prepared considering these observations and removing the factor B.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="DOE.html#cb243-1" aria-hidden="true" tabindex="-1"></a>battery_reduced_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb243-2"><a href="DOE.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">*</span> C, </span>
<span id="cb243-3"><a href="DOE.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging</span>
<span id="cb243-4"><a href="DOE.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb243-5"><a href="DOE.html#cb243-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_reduced_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A * C, data = battery_charging)

Residuals:
   Min     1Q Median     3Q    Max 
-3.696 -1.062 -0.483  0.952  3.054 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    6.787      0.321   21.16   &lt;2e-16 ***
A              0.940      0.321    2.93   0.0067 ** 
C              1.040      0.321    3.24   0.0030 ** 
A:C           -0.809      0.321   -2.52   0.0176 *  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.81 on 28 degrees of freedom
Multiple R-squared:  0.476,	Adjusted R-squared:  0.42 
F-statistic: 8.49 on 3 and 28 DF,  p-value: 0.000361</code></pre>
<p>Besides the base <code>summary()</code> function, R squared and adjusted R squared can also be easily retrieved with the glance function from the <code>{broom}</code> package. Weâre extracting them here for the complete and for reduced model:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="DOE.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(battery_lm)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="DOE.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">glance</span>(battery_reduced_lm)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], </span>
<span id="cb245-3"><a href="DOE.html#cb245-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">.id =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  model r.squared adj.r.squared
  &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1 1         0.540         0.405
2 2         0.476         0.420</code></pre>
<p>Although R-squared has decreased the adjusted R-squared has slightly improved showing that removing the non significant terms has resulted in a better fit. The changes are small and further work is still required but the principle is clear that the model fit is improving and will better forecast the output for new data.</p>
</div>
<div id="coding_inputs" class="section level3">
<h3>Coding inputs</h3>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="DOE.html#cb247-1" aria-hidden="true" tabindex="-1"></a>natural2coded <span class="ot">&lt;-</span> <span class="cf">function</span>(xA, lA, hA) {(xA <span class="sc">-</span> (lA <span class="sc">+</span> hA) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> ((hA <span class="sc">-</span>  lA) <span class="sc">/</span> <span class="dv">2</span>)}</span></code></pre></div>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="DOE.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting natural value xA into coded value cA:</span></span>
<span id="cb248-2"><a href="DOE.html#cb248-2" aria-hidden="true" tabindex="-1"></a>lA <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb248-3"><a href="DOE.html#cb248-3" aria-hidden="true" tabindex="-1"></a>hA <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb248-4"><a href="DOE.html#cb248-4" aria-hidden="true" tabindex="-1"></a>nA <span class="ot">&lt;-</span> <span class="dv">22</span></span>
<span id="cb248-5"><a href="DOE.html#cb248-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-6"><a href="DOE.html#cb248-6" aria-hidden="true" tabindex="-1"></a>cA <span class="ot">&lt;-</span> <span class="fu">natural2coded</span>(nA, lA, hA)</span>
<span id="cb248-7"><a href="DOE.html#cb248-7" aria-hidden="true" tabindex="-1"></a>cA</span></code></pre></div>
<pre><code>[1] 0.28</code></pre>
<p>The consulting company proposed itself to provide a tool to predict the charging time for new batteries. They had been doing lots of the DOEs and based on the last one theyâve realised they believe to be in a position to calculate the response at a certainly specific level between the coded factor levels of <span class="math inline">\(\pm\)</span> 1. To do that they needed to convert natural values into coded values. Theyâve given as an example a calculation of the charging time for a temperature of which the natural value is nA = 22 [Â°C] which is between the natural levels of lA = -10 and hA = 40 [Â°C]. This temperature coded corresponds to a value of 0.28 Â°C as presented in the previous chunk. To be noted that the opposite conversion would look like:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="DOE.html#cb250-1" aria-hidden="true" tabindex="-1"></a>coded2natural <span class="ot">&lt;-</span> <span class="cf">function</span>(cA, lA, hA) {cA <span class="sc">*</span> ((hA <span class="sc">-</span> lA) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> ((lA <span class="sc">+</span> hA)<span class="sc">/</span><span class="dv">2</span>)} </span></code></pre></div>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="DOE.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting back the coded value cA into its natural value xA</span></span>
<span id="cb251-2"><a href="DOE.html#cb251-2" aria-hidden="true" tabindex="-1"></a>lA <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb251-3"><a href="DOE.html#cb251-3" aria-hidden="true" tabindex="-1"></a>hA <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb251-4"><a href="DOE.html#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="DOE.html#cb251-5" aria-hidden="true" tabindex="-1"></a>nA <span class="ot">&lt;-</span> <span class="fu">coded2natural</span>(cA, lA, hA)</span>
<span id="cb251-6"><a href="DOE.html#cb251-6" aria-hidden="true" tabindex="-1"></a>nA</span></code></pre></div>
<pre><code>[1] 22</code></pre>
</div>
<div id="coded_prediction" class="section level3">
<h3>Coded prediction</h3>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="DOE.html#cb253-1" aria-hidden="true" tabindex="-1"></a>battery_new <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">A =</span> cA, <span class="at">C =</span> <span class="dv">1</span>)</span>
<span id="cb253-2"><a href="DOE.html#cb253-2" aria-hidden="true" tabindex="-1"></a>pA <span class="ot">&lt;-</span> <span class="fu">predict</span>(battery_reduced_lm, battery_new)</span>
<span id="cb253-3"><a href="DOE.html#cb253-3" aria-hidden="true" tabindex="-1"></a>pA</span></code></pre></div>
<pre><code>     1 
7.8634 </code></pre>
<p>Theyâve choosen to do this prediction for a fixed level of C of 1, corresponding to a completely new battery (maximum of the factor C at of 0 cycles) and the <code>predict()</code> function with those values and the reduced model. We can visualize the outcome as follows:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="DOE.html#cb255-1" aria-hidden="true" tabindex="-1"></a>battery_charging <span class="sc">%&gt;%</span></span>
<span id="cb255-2"><a href="DOE.html#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(C <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb255-3"><a href="DOE.html#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb255-4"><a href="DOE.html#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(aes(x = A, y = charging_time, color = as_factor(C))) +</span></span>
<span id="cb255-5"><a href="DOE.html#cb255-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> A, <span class="at">y =</span> charging_time), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb255-6"><a href="DOE.html#cb255-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> cA, <span class="at">y =</span> pA)) <span class="sc">+</span></span>
<span id="cb255-7"><a href="DOE.html#cb255-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb255-8"><a href="DOE.html#cb255-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb255-9"><a href="DOE.html#cb255-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>()) <span class="sc">+</span></span>
<span id="cb255-10"><a href="DOE.html#cb255-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> pA, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb255-11"><a href="DOE.html#cb255-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb255-12"><a href="DOE.html#cb255-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb255-13"><a href="DOE.html#cb255-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb255-14"><a href="DOE.html#cb255-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb255-15"><a href="DOE.html#cb255-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Lithium-ion battery charging DOE&quot;</span>,</span>
<span id="cb255-16"><a href="DOE.html#cb255-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Charging time [h]&quot;</span>,</span>
<span id="cb255-17"><a href="DOE.html#cb255-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;A: temperature (-1 = -10Â°C, +1 = 40Â°C)&quot;</span>,</span>
<span id="cb255-18"><a href="DOE.html#cb255-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Prediction with reduced model&quot;</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-26-1.png" width="100%" /></p>
</div>
<div id="persp" class="section level3">
<h3>Perspective plot</h3>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="DOE.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsm)</span></code></pre></div>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="DOE.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(</span>
<span id="cb257-2"><a href="DOE.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  battery_reduced_lm, </span>
<span id="cb257-3"><a href="DOE.html#cb257-3" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> C, </span>
<span id="cb257-4"><a href="DOE.html#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">bounds =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">C =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)),</span>
<span id="cb257-5"><a href="DOE.html#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">8</span>],</span>
<span id="cb257-6"><a href="DOE.html#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta =</span> <span class="sc">-</span><span class="dv">40</span>, <span class="at">phi =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">5</span>,</span>
<span id="cb257-7"><a href="DOE.html#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zlab =</span> <span class="st">&quot;Charging Time [h]&quot;</span>,</span>
<span id="cb257-8"><a href="DOE.html#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlabs =</span> <span class="fu">c</span>(</span>
<span id="cb257-9"><a href="DOE.html#cb257-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;A: Temperature&quot;</span>, </span>
<span id="cb257-10"><a href="DOE.html#cb257-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;C: Age&quot;</span>),</span>
<span id="cb257-11"><a href="DOE.html#cb257-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Lithium-ion battery</span><span class="sc">\n</span><span class="st">charging time DOE&quot;</span></span>
<span id="cb257-12"><a href="DOE.html#cb257-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-28-1.png" width="100%" /></p>
<p>Here they went further introducing here response surface plots which is yet another way to visualize the experiment outputs as a function of the inputs. Theâve done this with the <code>persp()</code> function from the <code>{rsm}</code> package which provides an extremely fast rendering, easy parametrization and a readable output. To be noted that this function is an extension of the base R <code>persp()</code> consisting from the R point of view in an S3 method for the lm class. This allows to simply provide directly the lm object to the function to obtain the response surface.</p>
<p>Due to the interaction between factors A and C the surface is bent. This is exactly what we observe in the interactions plots of which the one below corresponds to slicing the surface at the min and the max of Power:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="DOE.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(<span class="at">x.factor =</span> battery_charging<span class="sc">$</span>C, </span>
<span id="cb258-2"><a href="DOE.html#cb258-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace.factor =</span> battery_charging<span class="sc">$</span>A,</span>
<span id="cb258-3"><a href="DOE.html#cb258-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fun =</span> mean,</span>
<span id="cb258-4"><a href="DOE.html#cb258-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">response =</span> battery_charging<span class="sc">$</span>charging_time,</span>
<span id="cb258-5"><a href="DOE.html#cb258-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb258-6"><a href="DOE.html#cb258-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab =</span> <span class="st">&quot;C: Age </span><span class="sc">\n</span><span class="st">(-1 = 10&#39;000 cycles, +1 = 0 cycles)&quot;</span>,</span>
<span id="cb258-7"><a href="DOE.html#cb258-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace.label =</span> <span class="st">&quot;A: Temperature </span><span class="sc">\n</span><span class="st">(+1 = 40Â°C, -1 = -10Â°C)&quot;</span>,</span>
<span id="cb258-8"><a href="DOE.html#cb258-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb258-9"><a href="DOE.html#cb258-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">8</span>],</span>
<span id="cb258-10"><a href="DOE.html#cb258-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ylab =</span> <span class="st">&quot;Charging Time&quot;</span>,</span>
<span id="cb258-11"><a href="DOE.html#cb258-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main =</span> <span class="st">&quot;Lithium-ion battery</span><span class="sc">\n</span><span class="st">charging time test&quot;</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-29-1.png" width="100%" /></p>
<p>Just like in the surface plot we can see here in the interaction plot that the response of charging time on age is very different depending on the level of temperature. When temperature is at its max the charging time is almost independent of age but at the minumum of temperature the charging time depends a lot on the age. All this make a lot of sense to everyone involved but its good to confirm it with results and to get the details of how much these variations are numerically. As a reminder this is what is called an interaction between these two factors.</p>
</div>
<div id="single_replicate" class="section level3">
<h3>Single replicate</h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="DOE.html#cb259-1" aria-hidden="true" tabindex="-1"></a>battery_sr_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb259-2"><a href="DOE.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">*</span> B <span class="sc">*</span> C <span class="sc">*</span> D, </span>
<span id="cb259-3"><a href="DOE.html#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Replicate <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb259-4"><a href="DOE.html#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_sr_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A * B * C * D, data = battery_charging %&gt;% 
    filter(Replicate == 2))

Residuals:
ALL 16 residuals are 0: no residual degrees of freedom!

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  6.44e+00         NA      NA       NA
A            1.76e+00         NA      NA       NA
B           -2.50e-02         NA      NA       NA
C            6.75e-01         NA      NA       NA
D            1.05e+00         NA      NA       NA
A:B          7.50e-02         NA      NA       NA
A:C         -9.75e-01         NA      NA       NA
B:C         -3.12e-01         NA      NA       NA
A:D          4.00e-01         NA      NA       NA
B:D          4.13e-01         NA      NA       NA
C:D          1.25e-02         NA      NA       NA
A:B:C        4.12e-01         NA      NA       NA
A:B:D       -1.13e-01         NA      NA       NA
A:C:D       -2.63e-01         NA      NA       NA
B:C:D        5.00e-02         NA      NA       NA
A:B:C:D      6.94e-18         NA      NA       NA

Residual standard error: NaN on 0 degrees of freedom
Multiple R-squared:     1,	Adjusted R-squared:   NaN 
F-statistic:  NaN on 15 and 0 DF,  p-value: NA</code></pre>
<p>In the R&amp;D offices of the manufacturer of electrical car batteries there is some satisfaction with the report delivered by the data science consulting company. Although initially skeptical the head of battery engineering has finally acknowledged that there are several benefits coming from this work. Now, he makes a last moment request: he would like to know by thursday (after tomorrow) what is the effect of the terminals material. In his view this will for sure have a high impact on the final delivered cost of the assembled battery. Unfortunately data on terminals material was only captured in the 2nd replicate. We can check that in the original data for example in first two and last two rows. The variable coded as D is missing in the begining:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="DOE.html#cb261-1" aria-hidden="true" tabindex="-1"></a>battery_charging[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">31</span><span class="sc">:</span><span class="dv">32</span>),]</span></code></pre></div>
<pre><code># A tibble: 4 x 6
      A     B     C     D Replicate charging_time
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1    -1    -1    -1    -1        NA          3.5 
2     1    -1    -1    -1        NA          6.69
3    -1     1     1     1         2          7   
4     1     1     1     1         2          9.6 </code></pre>
<p>As a reminder below the DOE variables, including D are:</p>
<p>A - temperature (-1 = -10Â°C, +1 = 40Â°C)<br />
B - voltage (-1 = 120V, +1 = 220V)<br />
C - age (-1 = 10â000 cycles, +1 = 0 cycles)<br />
D - terminal (-1 = lead based, +1 = zinc based)<br />
Z - charging time [h]</p>
<p>As there is no time to collect new data, a specialist in DOEs from the consulting company suggests exploiting the the single replicate data using a graphical method - the normal probability plot - to identify the main effects that are important in the model. He demonstrates how to achieve this with the function qqPlot() from the {car} package:</p>
</div>
<div id="qqPlot" class="section level3">
<h3>Effects normal plot</h3>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="DOE.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="DOE.html#cb264-1" aria-hidden="true" tabindex="-1"></a>battery_sr_effects <span class="ot">&lt;-</span> battery_sr_lm<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb264-2"><a href="DOE.html#cb264-2" aria-hidden="true" tabindex="-1"></a>battery_sr_effects_names <span class="ot">&lt;-</span> <span class="fu">names</span>((battery_sr_lm<span class="sc">$</span>coefficients)[<span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>])</span>
<span id="cb264-3"><a href="DOE.html#cb264-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-4"><a href="DOE.html#cb264-4" aria-hidden="true" tabindex="-1"></a>main_effects_plot <span class="ot">&lt;-</span> <span class="fu">qqPlot</span>(</span>
<span id="cb264-5"><a href="DOE.html#cb264-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Model effects&quot;</span>,</span>
<span id="cb264-6"><a href="DOE.html#cb264-6" aria-hidden="true" tabindex="-1"></a>  battery_sr_effects, </span>
<span id="cb264-7"><a href="DOE.html#cb264-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="fl">0.95</span>, </span>
<span id="cb264-8"><a href="DOE.html#cb264-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">list</span>(</span>
<span id="cb264-9"><a href="DOE.html#cb264-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;y&quot;</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">carPalette</span>()[<span class="dv">1</span>], <span class="at">location =</span> <span class="st">&quot;lr&quot;</span>), </span>
<span id="cb264-10"><a href="DOE.html#cb264-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb264-11"><a href="DOE.html#cb264-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb264-12"><a href="DOE.html#cb264-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.lines =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">12</span>)[<span class="dv">5</span>],</span>
<span id="cb264-13"><a href="DOE.html#cb264-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Battery charging DOE</span><span class="sc">\n</span><span class="st">Normal plot of effects&quot;</span></span>
<span id="cb264-14"><a href="DOE.html#cb264-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-33-1.png" width="100%" /></p>
<p>In plot we can see that the effects that have the highest influence on the output are the effects A - temperature and D - terminal and their interaction. Its seems the head of engineering had a good intuition. The next step is a confirmation of these observations with a calculation of the percentage contribution of each effect as follows:</p>
</div>
<div id="effects_contribution" class="section level3">
<h3>Effects contribution table</h3>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="DOE.html#cb265-1" aria-hidden="true" tabindex="-1"></a>battery_sr_lm_tidy <span class="ot">&lt;-</span> battery_sr_lm <span class="sc">%&gt;%</span></span>
<span id="cb265-2"><a href="DOE.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb265-3"><a href="DOE.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-4"><a href="DOE.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb265-5"><a href="DOE.html#cb265-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect_estimate =</span> <span class="dv">2</span> <span class="sc">*</span> estimate)</span>
<span id="cb265-6"><a href="DOE.html#cb265-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-7"><a href="DOE.html#cb265-7" aria-hidden="true" tabindex="-1"></a>battery_sr_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(battery_sr_lm)</span>
<span id="cb265-8"><a href="DOE.html#cb265-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-9"><a href="DOE.html#cb265-9" aria-hidden="true" tabindex="-1"></a>battery_sr_aov_tidy <span class="ot">&lt;-</span> battery_sr_aov <span class="sc">%&gt;%</span> </span>
<span id="cb265-10"><a href="DOE.html#cb265-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb265-11"><a href="DOE.html#cb265-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(term, <span class="at">sumsq_total =</span> <span class="fu">sum</span>(sumsq),</span>
<span id="cb265-12"><a href="DOE.html#cb265-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">effect_contribution_perc =</span> sumsq<span class="sc">/</span>sumsq_total<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb265-13"><a href="DOE.html#cb265-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-14"><a href="DOE.html#cb265-14" aria-hidden="true" tabindex="-1"></a>main_effects_table <span class="ot">&lt;-</span> battery_sr_lm_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb265-15"><a href="DOE.html#cb265-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(battery_sr_aov_tidy, <span class="at">by =</span> <span class="st">&quot;term&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-16"><a href="DOE.html#cb265-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, estimate, effect_estimate, sumsq, effect_contribution_perc) <span class="sc">%&gt;%</span></span>
<span id="cb265-17"><a href="DOE.html#cb265-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(effect_contribution_perc))</span>
<span id="cb265-18"><a href="DOE.html#cb265-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-19"><a href="DOE.html#cb265-19" aria-hidden="true" tabindex="-1"></a>main_effects_table <span class="sc">%&gt;%</span></span>
<span id="cb265-20"><a href="DOE.html#cb265-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-21"><a href="DOE.html#cb265-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">effect_estimate</th>
<th align="right">sumsq</th>
<th align="right">effect_contribution_perc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="right">1.7625</td>
<td align="right">3.525</td>
<td align="right">49.7025</td>
<td align="right">49.2799</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="right">1.0500</td>
<td align="right">2.100</td>
<td align="right">17.6400</td>
<td align="right">17.4900</td>
</tr>
<tr class="odd">
<td align="left">A:C</td>
<td align="right">-0.9750</td>
<td align="right">-1.950</td>
<td align="right">15.2100</td>
<td align="right">15.0807</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="right">0.6750</td>
<td align="right">1.350</td>
<td align="right">7.2900</td>
<td align="right">7.2280</td>
</tr>
<tr class="odd">
<td align="left">B:D</td>
<td align="right">0.4125</td>
<td align="right">0.825</td>
<td align="right">2.7225</td>
<td align="right">2.6993</td>
</tr>
</tbody>
</table>
<p>We could see in the <code>lm()</code> output before that no statistics have been calculated for the effects in the model as there is only a single replicate.</p>
</div>
<div id="reduced-model" class="section level3">
<h3>Reduced model</h3>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="DOE.html#cb266-1" aria-hidden="true" tabindex="-1"></a>battery_red_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb266-2"><a href="DOE.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> charging_time <span class="sc">~</span> A <span class="sc">+</span> D <span class="sc">+</span> A<span class="sc">:</span>C, </span>
<span id="cb266-3"><a href="DOE.html#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> battery_charging <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Replicate <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb266-4"><a href="DOE.html#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(battery_red_lm)</span></code></pre></div>
<pre><code>
Call:
lm.default(formula = charging_time ~ A + D + A:C, data = battery_charging %&gt;% 
    filter(Replicate == 2))

Residuals:
   Min     1Q Median     3Q    Max 
-2.450 -0.338  0.163  0.425  2.200 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    6.438      0.309   20.85  8.6e-11 ***
A              1.763      0.309    5.71  9.8e-05 ***
D              1.050      0.309    3.40   0.0053 ** 
A:C           -0.975      0.309   -3.16   0.0083 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.24 on 12 degrees of freedom
Multiple R-squared:  0.819,	Adjusted R-squared:  0.773 
F-statistic:   18 on 3 and 12 DF,  p-value: 9.63e-05</code></pre>
<p>Following theses analysis a new model has been built, including only the effects and interactions with highest contribution. We can now see that weâve regained degrees of freedom and obtained a sort of hidden replication allowing to calculate statistics and error terms on the model. Checking the residuals the DOE specialist from the consulting company recommends to do another test now with proper replication but choosing only the variables of interest. These residuals show the limitations of this model deviating from normality above <span class="math inline">\(\pm\)</span> 1 standard deviation and showing difference variance at different levels.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="DOE.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb268-2"><a href="DOE.html#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(battery_red_lm<span class="sc">$</span>residuals)</span>
<span id="cb268-3"><a href="DOE.html#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(battery_red_lm, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb268-4"><a href="DOE.html#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(battery_red_lm, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb268-5"><a href="DOE.html#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(battery_red_lm, <span class="at">which =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="9_twolevelDOEs_files/figure-html/unnamed-chunk-36-1.png" width="100%" /></p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="DOE.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>() </span></code></pre></div>
<pre><code>null device 
          1 </code></pre>
<p>In any case from the linear model coefficients we can already see that the selection of terminal material has a significative effect which is of about 60% of the effect of the temperature (1â050/1â763).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="MSA.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SPC.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": false,
"info": false,
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
